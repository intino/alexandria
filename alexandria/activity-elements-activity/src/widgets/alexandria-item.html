<link rel="import" href="../../lib/polymer/polymer.html">
<link rel="import" href="../../lib/cotton-push/cotton-push-behavior.html">
<link rel="import" href="../../lib/cotton-carrier/cotton-carrier-behavior.html">
<link rel="import" href="../../lib/cotton-zombie/cotton-zombie.html">
<link rel="import" href="../../lib/cotton-translator/cotton-translator-behavior.html">
<link rel="import" href="_common/mold/alexandria-mold-container.html">
<link rel="import" href="alexandria-page-container.html">

<script src="alexandriaitem/requester.js"></script>
<script src="alexandriaitem/notifier-listener.js"></script>

<dom-module id="alexandria-item">

    <template>
        <alexandria-mold-container mold="[[_mold]]" item="[[_item]]" mode="[[_mode]]"
                                   on-stamps-ready="_itemStampsReady"
                                   on-navigate-item="_navigateItem"
                                   on-navigate-catalog="_navigateCatalog"
                                   on-open-dialog="_openStampDialog"
                                   on-open-catalog="_openStampCatalog"
                                   on-execute-task-item="_executeTask"
                                   on-download-item="_download"
                                   on-change-item="_change"
                                   on-validate-item="_validate"
                                   on-export-item="_export"></alexandria-mold-container>
        <template is="dom-if" if="[[!_item]]">
            <div class="message layout horizontal center center-justified">[[_emptyMessage]]</div>
        </template>
    </template>

    <style>
        :host .message {
            height: 100%;
        }
        :host alexandria-mold {
            display: block;
            overflow: auto;
            height: 100%;
        }
        :host alexandria-mold ::content > div {
            height: calc(100% - 20px);
        }
    </style>

    <script>

        const AlexandriaItemDictionary = {
            es: {
                EmptyMessage : "no hay elemento"
            },
            en: {
                EmptyMessage : "no element"
            }
        };

        Polymer({
            is: 'alexandria-item',

            behaviors: [ CottonBehaviors.CarrierBehavior,
                CottonBehaviors.PushBehavior,
                CottonBehaviors.TranslatorBehavior,
                AlexandriaItemBehaviors.Requester,
                AlexandriaItemBehaviors.NotifierListener ],

            properties : {
                _mold: { type: String, value: function() { return null; } },
                _item: { type: Object, value: function() { return null; } },
                _mode: { type: String, value: function() { return null; } },
                _emptyMessage: String
            },

            attached : function() {
                this.translate(AlexandriaItemDictionary);
                this.listenToDisplay();
            },

            _refresh : function(info) {
                this._reset();
                this._mold = info.mold;
                this._item = info.item;
            },

            _reset : function() {
                this._mold = this._item = null;
            },

            _refreshMode : function(mode) {
                this._mode = mode;
            },

            _refreshEmptyMessage : function(value) {
                this._emptyMessage = value != null ? value : this.EmptyMessage;
            },

            _itemStampsReady : function(event) {
                if (this.ready) window.clearTimeout(this.ready);
                this.ready = window.setTimeout(() => this.itemStampsReady(this._item.name), 300);
            },

            _navigateItem : function(e) {
                this.openItem(e.detail);
            },

            _navigateCatalog : function(e) {
                this.openElement(e.detail);
            },

            _openStampDialog : function(e) {
                this.openItemDialogOperation(e.detail);
            },

            _openStampCatalog : function(e) {
                this.openItemCatalogOperation(e.detail);
            },

            _download : function(e) {
                this.downloadItemOperation(e.detail);
            },

            _change : function(e) {
                this.changeItem(e.detail);
            },

            _validate : function(e) {
                this.validateItem(e.detail);
            },

            _export : function(e) {
                this.exportItemOperation(e.detail);
            },

            _executeTask : function(e) {
                this.executeItemTaskOperation(e.detail);
            }

        });
    </script>
</dom-module>