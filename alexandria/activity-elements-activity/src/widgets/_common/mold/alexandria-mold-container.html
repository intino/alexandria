<link rel="import" href="../../../../lib/polymer/polymer.html">
<link rel="import" href="../../../../lib/cotton-translator/cotton-translator-behavior.html">
<link rel="import" href="../alexandria-breadcrumbs-behavior.html">
<link rel="import" href="alexandria-mold-block.html">
<link rel="import" href="alexandria-mold-layout-behavior.html">

<dom-module id="alexandria-mold-container">

    <template>
        <div id="container"></div>
    </template>

    <script>
        Polymer({
            is: 'alexandria-mold-container',

            properties : {
                item : { type: Object, observer: '_createMold', value: function() { return null; } },
                mold : { type: String, observer: '_createMold', value: function() { return null; } },
                mode : { type: String, observer: '_createMold', value: function() { return "list"; } },
                _stampsReadyTimeout : { type: Number, value : function() { return null; }}
            },

            highlight : function() {
                var mold = this.querySelector(this.mold);
                if (mold == null) return;
                mold.highlight();
            },

            refreshPicture : function(pictureData) {
                var mold = this.querySelector(this.mold);
                if (mold == null) return;
                mold.refreshPicture(pictureData);
            },

            _createMold : function() {
                if (this.item == null || this.mold == null) return;
                var mold = this.$.container.querySelector(".mold-wrap");
                if (mold == null) {
                    mold = document.createElement(this.mold);
                    mold.addEventListener("stamp-ready", () => this._notifyStampsReady());
                    this.$.container.appendChild(mold);
                    $(mold).addClass("mold-wrap");
                }
                mold.mode = this.mode;
                mold.item = this.item;
            },

            _notifyStampsReady : function() {
                if (this.stampsReadyTimeout) window.clearTimeout(this.stampsReadyTimeout);
                this.stampsReadyTimeout = window.setTimeout(() => this.fire("stamps-ready"), 100);
            }
        });
    </script>

</dom-module>
