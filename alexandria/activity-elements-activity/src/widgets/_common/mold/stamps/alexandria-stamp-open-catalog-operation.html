<link rel="import" href="../../../../../lib/polymer/polymer.html">
<link rel="import" href="../../../../../lib/paper-dialog/paper-dialog.html">
<link rel="import" href="../../../../../lib/iron-resizable/iron-resizable-behavior.html">
<link rel="import" href="alexandria-stamp-behavior.html">
<link rel="import" href="../alexandria-operation-trigger.html">

<dom-module id="alexandria-stamp-open-dialog-operation">

    <template>
        <alexandria-operation-trigger title="[[stamp.label]]" on-execute="_openCatalog"
                                      icon="[[stamp.properties.alexandriaIcon]]"
                                      mode="[[stamp.properties.mode]]"
                                      style$="[[_style]]"></alexandria-operation-trigger>

        <paper-dialog id="dialog" entry-animation="scale-up-animation"
                      exit-animation="fade-out-animation"
                      on-iron-overlay-opened="_overlayOpened"
                      on-iron-overlay-closed="_overlayClosed">
            <div id="container" class="layout flex" style$="[[_style]]"></div>
        </paper-dialog>
    </template>

    <style>
    </style>

    <script>
        Polymer({
            is: 'alexandria-stamp-open-dialog-operation',

            behaviors : [ AlexandriaBehaviors.StampBehavior, Polymer.IronResizableBehavior ],

            listeners: {
                'iron-resize': '_resize'
            },

            _resize : function() {
                this._addStyle(this._catalogElement());
            },

            _addStyle : function(catalog) {
                if (this.stamp != null && this.stamp.layout == "Flexible") {
                    catalog.style.height = "100%";
                    this.querySelectorAll("alexandria-catalog-view-list").forEach((viewList) => viewList.style.overflow = "hidden");
                    this.querySelectorAll("cotton-list").forEach((list) => list.style.height = "100%");
                    return;
                }
                var height = $(this).parent().height() + "px";
                catalog.style.height = height;
                catalog.style.display = "block";
            },

            _render : function() {
                var key = this.stamp.item + this.stamp.name;
                var catalog = this.stamp.properties.catalog;
                var rendered = this.$.container.innerHTML != "";

                if (key == null || catalog == null || rendered) return;
                this._addZombieLayer(this.$.container, catalog, catalog, key);
            },

            _catalogElement : function() {
                var result = this.querySelector("#container > *");
                return result != null ? result : { style: {} };
            },

            _openCatalog : function(e) {
                this.$.dialog.open();
            }
        });
    </script>

</dom-module>
