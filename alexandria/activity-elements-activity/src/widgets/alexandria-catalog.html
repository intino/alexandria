<link rel="import" href="../../lib/polymer/polymer.html">
<link rel="import" href="../../lib/cotton-push/cotton-push-behavior.html">
<link rel="import" href="../../lib/cotton-carrier/cotton-carrier-behavior.html">
<link rel="import" href="../../lib/cotton-zombie/cotton-zombie.html">
<link rel="import" href="../../lib/cotton-translator/cotton-translator-behavior.html">
<link rel="import" href="../../lib/paper-toast/paper-toast.html">
<link rel="import" href="_common/catalog/alexandria-catalog-grouping-list.html">
<link rel="import" href="alexandria-catalog-view-list.html">
<link rel="import" href="alexandria-dialog-box.html">
<link rel="import" href="../../lib/cotton-breadcrumbs/cotton-breadcrumbs.html">
<link rel="import" href="_common/alexandria-breadcrumbs-behavior.html">
<link rel="import" href="_common/alexandria-element-behavior.html">

<script src="alexandriacatalog/requester.js"></script>
<script src="alexandriacatalog/notifier-listener.js"></script>

<dom-module id="alexandria-catalog">

    <template>
        <h3 hidden$="[[!_showLabel]]">[[_catalog.label]]</h3>
        <div class="breadcrumbs layout horizontal" hidden$="[[!_breadcrumbs.length]]">
            <paper-button on-tap="_navigateMain">[[Back]]</paper-button>
            <cotton-breadcrumbs items="[[_breadcrumbs]]" on-item-selected="_navigate"></cotton-breadcrumbs>
        </div>
        <div id="main" class$="layout horizontal embedded_[[_catalog.embedded]]">
            <a id="showGroupingsButton" class="layout vertical center center-justified" hidden="[[_hideGroupings]]" on-tap="_showGroupingsDialog"><div>[[ShowGroupings]]</div></a>
            <alexandria-catalog-grouping-list id="embeddedGroupings" hidden="[[_hideGroupings]]"
                                              histograms-mode="[[_catalog.arrangementHistogramsMode]]"
                                              grouping-list="[[_catalog.groupingList]]"
                                              on-grouping-selection-change="_handleGroupingChange"
                                              on-delete-grouping-group="_handleDeleteGroupingGroup"></alexandria-catalog-grouping-list>
            <div class="main flex">
                <a class="clear" hidden$="[[!_filtered]]" on-tap="clearFilter">[[ClearFilter]]</a>
                <cotton-zombie display="AlexandriaCatalogViewList" widget="AlexandriaCatalogViewList"></cotton-zombie>
            </div>
        </div>
        <div id="panel" name="panel" class="layout vertical flex hidden" style="height:calc(100% - 60px);"></div>
        <cotton-zombie display="AlexandriaDialogBox" widget="AlexandriaDialogBox"></cotton-zombie>
        <paper-toast id="notifyMessageToast" class="fit-bottom message" text="[[_message]]"></paper-toast>
        <paper-dialog id="groupingsDialog" no-overlap>
            <h2>[[ShowGroupings]]</h2>
            <alexandria-catalog-grouping-list hidden="[[_hideGroupings]]"
                                              grouping-list="[[_catalog.groupingList]]"
                                              on-grouping-selection-change="_handleGroupingChange"
                                              on-delete-grouping-group="_handleDeleteGroupingGroup"></alexandria-catalog-grouping-list>
            <div class="buttons">
                <paper-button dialog-dismiss>[[Close]]</paper-button>
            </div>
        </paper-dialog>
    </template>

    <style>
        :host {
            position: relative;
        }
        :host > h3 {
            margin: 0 0 0 22px;
        }
        :host > div {
            width: 100%;
            height: 100%;
        }
        :host .main {
            border: 0 solid #ddd;
            display: block;
            width: 100%;
            height: 100%;
        }
        :host .embedded_true .main {
            border-right-width: 0;
        }
        :host .filtered_true .main alexandria-catalog-view-list {
            height: calc(100% - 24px);
        }
        :host .clear {
            position: static;
            right: 0;
            background: wheat;
            padding: 8px 10px;
            z-index: 1;
            cursor: pointer;
            width: calc(100% - 20px);
            display: block;
            text-align: right;
            font-size: 10pt;
            color: var(--default-primary-color);
        }
        :host #showGroupingsButton {
            display: none;
            background: var(--default-primary-color);
            cursor: pointer;
            width: 39px;
            border-right: 1px solid white;
        }
        :host #showGroupingsButton div {
            transform: rotate(90deg);
            background: transparent;
            color: white;
            width: 110px;
        }
        :host paper-dialog {
            background: white;
            padding: 10px;
        }
        :host paper-dialog paper-button {
            margin: 0 10px;
            min-width: 80px;
        }
        :host paper-dialog alexandria-catalog-grouping-list {
            display: block;
            margin: 0;
            max-height: 300px;
            border: 0;
            overflow: auto;
        }
        :host #panel {
            display: block;
            margin: 0px 6px;
            width: calc(100% - 12px);
            @apply(--alexandria-catalog-panels);
        }
        :host #main.hidden, :host #panel.hidden {
            position: absolute;
            left: -10000px;
        }
        :host .breadcrumbs {
            height: auto;
            @apply(--alexandria-catalog-breadcrumbs);
        }
        :host .breadcrumbs paper-button {
            background: white;
            color: black;
            border: 1px solid #388e3b;
            padding: 0 25px;
            border-radius: 30px;
            height: 31px;
            margin-top: 7px;
        }
        :host .breadcrumbs paper-button:hover {
            background: #388e3b;
            opacity: 0.9;
            color: white;
        }
        :host cotton-breadcrumbs {
            display: block;
            padding: 10px;
            --cotton-breadcrumbs-item-color: var(--default-primary-color);
            --cotton-breadcrumbs-item-border-color: var(--footer-background-color);
            --cotton-breadcrumbs-item-size: 10pt;
            --cotton-breadcrumbs-item-brothers-size: 10pt;
            --cotton-breadcrumbs-item-parents-size: 10pt;
        }
        @media screen and (max-width: 736px) {
            :host #showGroupingsButton {
                display: flex;
            }
            :host #embeddedGroupings {
                display: none;
            }
            :host .breadcrumbs paper-button {
                display: none;
            }
            :host cotton-breadcrumbs {
                margin-left: 30px;
                margin-top: 5px;
                margin-bottom: 0;
                padding-bottom: 0;
            }
            :host #main > .main {
                width: calc(100% - 40px);
            }
        }
    </style>

    <script>

        const AlexandriaCatalogDictionary = {
            es: {
                ClearFilter : "ver todos",
                ShowGroupings : "filtrar catálogo",
                Close : "cerrar",
                Back : "< volver al catálogo"
            },
            en: {
                ClearFilter : "view all",
                ShowGroupings : "filter catalog",
                Close : "close",
                Back : "< back to catalog"
            }
        };

        Polymer({
            is: 'alexandria-catalog',

            behaviors: [ CottonBehaviors.CarrierBehavior,
                CottonBehaviors.PushBehavior,
                CottonBehaviors.TranslatorBehavior,
                AlexandriaBehaviors.BreadcrumbsBehavior,
                AlexandriaBehaviors.ElementBehavior,
                AlexandriaCatalogBehaviors.Requester,
                AlexandriaCatalogBehaviors.NotifierListener ],

            properties : {
                embedded: { type: Boolean, value: function() { return false; } },
                _catalog: Object,
                _filtered : { type: Boolean, value: function() { return false; }},
                _hideGroupings: { type: Boolean, value: function() { return true; }}
            },

            attached : function() {
                this.translate(AlexandriaCatalogDictionary);
                this.listenToDisplay();
            },

            _refreshCatalog : function(catalog) {
                this._catalog = catalog;
                this._hideGroupings = this._catalog.hideGroupings;
                this._showLabel = catalog.embedded && catalog.label !== "";
            },

            _refreshFiltered : function(value) {
                this._filtered = value;
            },

            _selectGrouping : function(event) {
            },

            _handleGroupingChange : function(event) {
                this.selectGrouping(event.detail);
            },

            _handleDeleteGroupingGroup : function(event) {
                this.deleteGroupingGroup(event.detail);
            },

            _showGroupingsDialog : function () {
                this.$.groupingsDialog.open();
            },

            _navigateMain : function() {
                this.navigateMain();
            }

        });

    </script>
</dom-module>