<link rel="import" href="../../lib/polymer/polymer.html">
<link rel="import" href="../../lib/cotton-push/cotton-push-behavior.html">
<link rel="import" href="../../lib/cotton-carrier/cotton-carrier-behavior.html">
<link rel="import" href="../../lib/cotton-zombie/cotton-zombie.html">
<link rel="import" href="../../lib/cotton-translator/cotton-translator-behavior.html">
<link rel="import" href="../../lib/paper-tabs/paper-tabs.html">
<link rel="import" href="../../lib/paper-tabs/paper-tab.html">
<link rel="import" href="alexandria-catalog-magazine-view.html">
<link rel="import" href="alexandria-catalog-list-view.html">
<link rel="import" href="alexandria-catalog-map-view.html">
<link rel="import" href="alexandria-catalog-display-view.html">
<link rel="import" href="_common/catalog/alexandria-catalog-view-behavior.html">

<script src="alexandriacatalogviewlist/requester.js"></script>
<script src="alexandriacatalogviewlist/notifier-listener.js"></script>

<dom-module id="alexandria-catalog-view-list">

    <template>
        <div class="layout horizontal end-justified" hidden$="[[_viewListHidden]]">
            <paper-tabs selected="{{_selectedView}}">
                <template is="dom-repeat" items="[[_viewList]]" as="view">
                    <paper-tab view="[[view]]">[[_viewLabelOf(view)]]</paper-tab>
                </template>
            </paper-tabs>
        </div>
        <iron-pages id="scrollingRegion" selected="{{_selectedView}}" class$="fullSize_[[_viewListHidden]]">
            <template is="dom-repeat" items="[[_viewList]]" as="view">
                <template is="dom-if" if="[[_isMagazineView(view)]]">
                    <div><cotton-zombie display="AlexandriaCatalogMagazineView" widget="AlexandriaCatalogMagazineView" object$="[[display.id]][[view.name]]"></cotton-zombie></div>
                </template>
                <template is="dom-if" if="[[_isListView(view)]]">
                    <div><cotton-zombie display="AlexandriaCatalogListView" widget="AlexandriaCatalogListView" object$="[[display.id]][[view.name]]"></cotton-zombie></div>
                </template>
                <template is="dom-if" if="[[_isGridView(view)]]">
                    <div><cotton-zombie display="AlexandriaCatalogListView" widget="AlexandriaCatalogListView" object$="[[display.id]][[view.name]]"></cotton-zombie></div>
                </template>
                <template is="dom-if" if="[[_isMapView(view)]]">
                    <div><cotton-zombie display="AlexandriaCatalogMapView" widget="AlexandriaCatalogMapView" object$="[[display.id]][[view.name]]"></cotton-zombie></div>
                </template>
                <template is="dom-if" if="[[_isDisplayView(view)]]">
                    <div><cotton-zombie display="AlexandriaCatalogDisplayView" widget="AlexandriaCatalogDisplayView" object$="[[display.id]][[view.name]]"></cotton-zombie></div>
                </template>
            </template>
        </iron-pages>
    </template>

    <style>
        :host paper-tabs {
            width: 200px;
            height: 25px;
            --paper-tabs-selection-bar: {
                border-color: var(--accent-color);
            }
        }
        :host iron-pages {
            height: calc(100% - 25px);
            overflow: auto;
        }
        :host iron-pages.fullSize_true {
            height: calc(100%);
        }
        :host iron-pages > div {
            height: 100%;
            overflow: hidden;
        }
    </style>

    <script>

        const AlexandriaCatalogViewListDictionary = {
            es: {
            },
            en: {
            }
        };

        Polymer({
            is: 'alexandria-catalog-view-list',
            lastViewIndex : null,

            behaviors: [ CottonBehaviors.CarrierBehavior,
                CottonBehaviors.PushBehavior,
                CottonBehaviors.TranslatorBehavior,
                AlexandriaBehaviors.CatalogViewBehavior,
                AlexandriaCatalogViewListBehaviors.Requester,
                AlexandriaCatalogViewListBehaviors.NotifierListener ],

            properties : {
                _viewList: Array,
                _viewListHidden: Boolean,
                _selectedView: { type: Number, value: function () { return 0; }, observer: '_selectView' }
            },

            attached : function() {
                this.translate(AlexandriaCatalogViewListDictionary);
                this.translate(AlexandriaBehaviors.CatalogViewBehavior.Dictionary);
                this.listenToDisplay();
            },

            _refreshViewList : function(viewList) {
                this._viewList = this._addBooleanType(viewList);
                this._viewListHidden = this._viewList.length <= 1;
            },

            _refreshSelectedView : function(name) {
                var index = this._viewIndex(name);
                if (this._selectedView == index) return;
                this._selectedView = index;
            },

            _viewIndex : function(name) {
                for (var i=0; i<this._viewList.length; i++)
                    if (this._viewList[i].name == name)
                        return i;
                return 0;
            },

            _addBooleanType : function(viewList) {
                return viewList;
                for(var i=0; i<viewList.length; i++) {
                    var view = viewList[i];
                    this.magazine = this._isMagazineView(view);
                    this.list = this._isListView(view);
                    this.map = this._isMapView(view);
                    this.display = this._isDisplayView(view);
                }
            },

            _selectView : function(pos) {
                var element = this.querySelector("paper-tabs").items[pos];
                if (element == null) return;
                if (this.lastViewIndex == pos) return;
                this.lastViewIndex = pos;
                this.selectView(element.view.name);
            }

        });
    </script>
</dom-module>