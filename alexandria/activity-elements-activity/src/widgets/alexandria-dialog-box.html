<link rel="import" href="../../lib/polymer/polymer.html">
<link rel="import" href="../../lib/cotton-push/cotton-push-behavior.html">
<link rel="import" href="../../lib/cotton-carrier/cotton-carrier-behavior.html">
<link rel="import" href="../../lib/cotton-zombie/cotton-zombie.html">
<link rel="import" href="../../lib/cotton-translator/cotton-translator-behavior.html">
<link rel="import" href="../../lib/paper-dialog/paper-dialog.html">
<link rel="import" href="../../lib/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../lib/iron-icons/iron-icons.html">
<link rel="import" href="../../lib/neon-animation/animations/scale-up-animation.html">
<link rel="import" href="../../lib/neon-animation/animations/fade-out-animation.html">
<link rel="import" href="../../lib/iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="_common/alexandria-configuration-behavior.html">
<link rel="import" href="_common/alexandria-dialog-box-behavior.html">

<script src="alexandriadialogbox/requester.js"></script>
<script src="alexandriadialogbox/notifier-listener.js"></script>

<dom-module id="alexandria-dialog-box">

    <template>
        <paper-dialog id="dialog" entry-animation="scale-up-animation"
                      exit-animation="fade-out-animation"
                      on-iron-overlay-opened="_overlayOpened"
                      on-iron-overlay-closed="_overlayClosed"
                      with-backdrop>
            <div class="container">
                <div class="header layout horizontal center">
                    <div class="label flex">[[_label]]</div>
                    <paper-icon-button icon="close" on-tap="close"></paper-icon-button>
                </div>
                <div class$="toolbar-visible-[[_toolbarVisible]]" id="displayContent"></div>
                <div class="toolbar layout horizontal center end-justified" hidden$="[[!_toolbarVisible]]">
                    <paper-button on-tap="accept">[[Accept]]</paper-button>
                </div>
            </div>
        </paper-dialog>
    </template>

    <style>
        :host {
            display: block;
            margin: 0;
            padding: 0;
        }
        :host paper-dialog {
            margin: 50px;
            padding: 0;
            background: white;
        }
        :host paper-dialog paper-icon-button {
            padding: 6px;
        }
        :host paper-dialog .container {
            border: 0;
            overflow: auto;
            border-radius: 2px;
            padding: 0;
            margin: 0;
            width: 100%;
            height: 100%;
        }
        :host paper-dialog .header {
            padding: 5px 5px 5px 15px;
            border-bottom: 1px solid #ddd;
        }
        :host paper-dialog .header .label {
            font-size: 12pt;
        }
        :host paper-dialog #displayContent {
            border: 0;
            overflow: auto;
            width: 100%;
            height: calc(100% - 51px);
            border-radius: 2px;
        }
        :host paper-dialog #displayContent.toolbar-visible-true {
            height: calc(100% - 102px);
        }
        :host paper-dialog .toolbar {
            height: 50px;
            border-top: 1px solid #ddd;
        }
        :host paper-dialog .toolbar paper-button {
            padding: 5px;
            margin-right: 15px;
        }
    </style>

    <script>

        const AlexandriaDialogBoxDictionary = {
            es: {
                Loading: "cargando di√°logo..."
            },
            en: {
                Loading: "loading dialog..."
            }
        };

        Polymer({
            is: 'alexandria-dialog-box',

            behaviors: [ CottonBehaviors.CarrierBehavior,
                CottonBehaviors.PushBehavior,
                CottonBehaviors.TranslatorBehavior,
                AlexandriaDialogBoxBehaviors.Requester,
                AlexandriaDialogBoxBehaviors.NotifierListener,
                AlexandriaBehaviors.ConfigurationBehavior,
                AlexandriaBehaviors.DialogBoxBehavior,
                Polymer.IronResizableBehavior ],

            properties : {
                _label : String,
                _type : String
            },

            attached : function() {
                this.translate(AlexandriaDialogBoxDictionary);
                this.translate(AlexandriaBehaviors.DialogBoxBehavior.Dictionary);
                this.listenToDisplay();
            },

            _refreshDisplay : function(display) {
                this._label = display.label;
                this._type = display.type;
                this._createZombie();
            },

            _refreshSettings : function(settings) {
                this._width = settings.width;
                this._height = settings.height;
                this._position = settings.position;
                this._toolbarVisible = settings.acceptButton;
            },

            _createZombie : function() {
                this.$.displayContent.innerHTML = "";
                var zombie = document.createElement("cotton-zombie");
                zombie.setAttribute("display", this._type);
                zombie.setAttribute("widget", this._type);
                zombie.setAttribute("object", this.display.id);
                this.$.displayContent.appendChild(zombie);
            }

        });

    </script>
</dom-module>