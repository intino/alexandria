<link rel="import" href="../../../lib/polymer/polymer.html">
<link rel="import" href="../../../lib/cotton-push/cotton-push-behavior.html">
<link rel="import" href="../../../lib/cotton-carrier/cotton-carrier-behavior.html">
<link rel="import" href="../../../lib/cotton-zombie/cotton-zombie.html">
<link rel="import" href="../../../lib/cotton-translator/cotton-translator-behavior.html">
<link rel="import" href="../_common/alexandria-item-selector-combo.html">
<link rel="import" href="../_common/alexandria-date-selector.html">
<link rel="import" href="../_common/alexandria-scale-selector-slider.html">

<script src="requester.js"></script>
<script src="notifier-listener.js"></script>

<dom-module id="alexandria-pocket-time-navigator">

    <template>
        <div class="field">
            <label>[[Scale]]</label>
            <div><alexandria-item-selector-combo label="" items="[[_scaleList]]" selected="[[_selectedScaleEntity]]" on-item-selected="_notifyScaleSelected" boxed></alexandria-item-selector-combo></div>
        </div>
        <div class="field">
            <label>[[Date]]</label>
            <alexandria-date-selector id="dateSelector" date="[[_date]]" scale="[[_selectedScale]]" label="" on-change="_selectDate" short></alexandria-date-selector>
        </div>
    </template>

    <style>
        :host {
            display: block;
            position: relative;
        }
        :host alexandria-item-selector-combo {
            display: block;
            width: 100%;
            --text-size: 10pt;
            --option-style : {
                min-height: 20px !important;
            }
        }
        :host .field {
            margin-bottom: 10px;
        }
        :host .field label {
            font-size: 9pt;
            color: var(--secondary-text-color);
        }
    </style>

    <script>

        const AlexandriaPocketTimeNavigatorDictionary = {
            es: {
                Scale: 'escala',
                Date: 'fecha'
            },
            en: {
                Scale: 'scale',
                Date: 'date'
            }
        };

        Polymer({
            is: 'alexandria-pocket-time-navigator',

            behaviors: [ CottonBehaviors.CarrierBehavior,
                         CottonBehaviors.PushBehavior,
                         CottonBehaviors.TranslatorBehavior,
                         AlexandriaTimeNavigatorBehaviors.Requester,
                         AlexandriaTimeNavigatorBehaviors.NotifierListener ],

            properties : {
                _olapRange : Object,
                _internalDate : { type: Object, value: function() { return new Date(); } },
                _slider : { type: Object },
                _maxDate : Object,
                _selectedScale : String,
                _selectedScaleEntity : Object
            },

            attached : function() {
                this.translate(AlexandriaPocketTimeNavigatorDictionary);
                this.listenToDisplay();
            },

            getDate : function() {
                return this._dateObject;
            },

            _refreshScales : function(scaleList) {
                this._scaleList = scaleList;
            },

            _refreshScale : function(scale) {
                this._selectedScale = scale;
                this._selectedScaleEntity = { name: scale };
                this._refresh();
            },

            _refreshOlapRange : function(range) {
                this._olapRange = range;
                this._refresh();
            },

            _refreshDate : function(date) {
                this._date = date;
                this._dateObject = new Date(date);
                this._refresh();
            },

            _refreshState : function(date) {
            },

            _refresh : function() {
            },

            _selectDate : function(event) {
                this.selectDate(event.detail.date);
            },

            _notifyScaleSelected : function(e) {
                this.selectScale(e.detail);
            }

        });
    </script>
</dom-module>