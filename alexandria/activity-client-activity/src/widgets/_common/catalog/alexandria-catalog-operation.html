<link rel="import" href="../../../../lib/polymer/polymer.html">
<link rel="import" href="../../../../lib/cotton-translator/cotton-translator-behavior.html">
<link rel="import" href="../../../../lib/paper-button/paper-button.html">
<link rel="import" href="../../../../lib/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../mold/alexandria-mold-download-operation.html">
<link rel="import" href="../alexandria-export-dialog.html">

<dom-module id="alexandria-catalog-operation">

    <template>
        <template is="dom-if" if="[[_isOperation(operation)]]">
            <paper-icon-button icon="[[operation.icon]]" title$="[[operation.title]]" on-tap="_execute"></paper-icon-button>
        </template>
        <template is="dom-if" if="[[_isDownload(operation)]]">
            <alexandria-mold-download-operation icon="[[operation.icon]]" title$="[[operation.title]]" options="[[_options()]]" on-download-option="_download"></alexandria-mold-download-operation>
        </template>
        <template is="dom-if" if="[[_isExport(operation)]]">
            <paper-icon-button icon="[[operation.icon]]" title$="[[operation.title]]" on-tap="_showExportDialog"></paper-icon-button>
        </template>
        <template is="dom-if" if="[[_isOpenDialog(operation)]]">
            <paper-icon-button icon="[[operation.icon]]" title$="[[operation.title]]" on-tap="_execute"></paper-icon-button>
        </template>
        <template is="dom-if" if="[[_isGrouping(operation)]]">
            <paper-icon-button icon="[[operation.icon]]" title$="[[operation.title]]" on-tap="_group"></paper-icon-button>
        </template>
        <alexandria-export-dialog on-export="_export"></alexandria-export-dialog>
    </template>

    <style>
    </style>

    <script>
        const AlexandriaCatalogOperationDictionary = {
            es: {
            },
            en: {
            }
        };

        Polymer({
            is: 'alexandria-catalog-operation',

            behaviors: [ CottonBehaviors.TranslatorBehavior ],

            properties : {
                operation: Object
            },

            attached: function () {
                this.translate(AlexandriaCatalogOperationDictionary);
            },

            _isOperation : function(operation) {
                return operation.type === "operation";
            },

            _isDownload : function(operation) {
                return operation.type === "download";
            },

            _isExport : function(operation) {
                return operation.type === "export";
            },

            _isOpenDialog : function(operation) {
                return operation.type === "open-dialog";
            },

            _isGrouping : function(operation) {
                return operation.type === "grouping";
            },

            _execute : function(e) {
                this.fire("execute", { operation: this.operation.name });
            },

            _download : function(e) {
                this.fire("download", { operation: this.operation.name, option: e.detail });
            },

            _group : function() {
                this.fire("group", { operation: this.operation.name });
            },

            _showExportDialog : function(e) {
                var properties = this._properties();
                var dialog = this.querySelector("alexandria-export-dialog");
                dialog.open({ min: parseInt(properties.from), max: parseInt(properties.to) });
            },

            _export : function(e) {
                var from = e.detail.from;
                var to = e.detail.to;
                this.fire("download", { operation: this.operation.name, from: from, to: to });
            },

            _options : function() {
                return this._properties()["options"].split(",");
            },

            _properties : function() {
                let propertyList = this.operation.propertyList;
                var result = {};
                for (var i=0; i<propertyList.length; i++)
                    result[propertyList[i].name] = propertyList[i].value;
                return result;
            }

        });
    </script>

</dom-module>
