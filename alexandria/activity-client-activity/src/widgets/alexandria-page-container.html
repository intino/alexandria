<link rel="import" href="../../lib/polymer/polymer.html">
<link rel="import" href="../../lib/cotton-push/cotton-push-behavior.html">
<link rel="import" href="../../lib/cotton-carrier/cotton-carrier-behavior.html">
<link rel="import" href="../../lib/cotton-zombie/cotton-zombie.html">
<link rel="import" href="../../lib/cotton-translator/cotton-translator-behavior.html">
<link rel="import" href="../../lib/paper-spinner/paper-spinner.html">
<link rel="import" href="../../lib/iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="_common/alexandria-configuration-behavior.html">

<script src="alexandriapagecontainer/requester.js"></script>
<script src="alexandriapagecontainer/notifier-listener.js"></script>

<dom-module id="alexandria-page-container">

    <template>
        <div id="main">
            <paper-spinner active id="loading" class="green layout vertical" title="[[Loading]]"></paper-spinner>
            <iframe id="frame" class="display" src="[[_displayLocation]]"></iframe>
        </div>
    </template>

    <style>
        :host {
            display: block;
        }
        :host > div {
            position: relative;
        }
        :host iframe {
            border: 0;
            height: 100%;
            width: 100%;
        }
        :host paper-spinner {
            height: 50px;
            width: 50px;
            top: 50%;
            margin: 0 auto;
        }
    </style>

    <script>

        const AlexandriaPageContainerDictionary = {
            es: {
                Loading: "cargando di√°logo..."
            },
            en: {
                Loading: "loading dialog..."
            }
        };

        Polymer({
            is: 'alexandria-page-container',

            behaviors: [ CottonBehaviors.CarrierBehavior,
                CottonBehaviors.PushBehavior,
                CottonBehaviors.TranslatorBehavior,
                Polymer.IronResizableBehavior,
                AlexandriaPageContainerBehaviors.Requester,
                AlexandriaPageContainerBehaviors.NotifierListener,
                AlexandriaBehaviors.ConfigurationBehavior ],

            properties : {
            },

            listeners: { 'iron-resize': '_resize' },

            attached : function() {
                this.translate(AlexandriaPageContainerDictionary);
                this.listenToDisplay();
                this.$.frame.onload = this._frameLoaded.bind(this);
            },

            _refreshLocation : function(location) {
                this.$.loading.active = true;
                var displayLocation = location.value;
                if (location.internal) displayLocation = this._internalLocationOf(displayLocation);
                this._displayLocation = displayLocation;
            },

            _internalLocationOf : function(location) {
                var startsWithSlash = location[0] === "/";
                return this.getBaseUrl() + (startsWithSlash ? "": "/") + location + "?random=" + Math.random();
            },

            _frameLoaded : function() {
                this.$.loading.active = false;
            },

            _resize : function() {
                $(this.$.main).height($(this).height());
            }

        });
    </script>
</dom-module>