<link rel="import" href="../../../../../lib/polymer/polymer.html">
<link rel="import" href="alexandria-stamp-behavior.html">

<script src="../../../../../lib/highcharts/highcharts.js"></script>
<script src="../../../../../lib/highcharts/highcharts-more.js"></script>

<dom-module id="alexandria-stamp-histogram">

    <template>
        <div class="container"></div>
    </template>

    <style>
        :host {
            display: block;
            height: 100%;
            width: 100%;
        }
        :host .container {
            height: 100%;
            width: 100%;
            margin-top: 0 !important;
        }
    </style>

    <script>
        Polymer({
            is: 'alexandria-stamp-histogram',

            behaviors: [ AlexandriaBehaviors.StampBehavior ],

            _render : function() {
                window.setTimeout(() => this._renderChart(this.stamp.properties.chartData), 100);
            },

            _renderChart : function(histogram) {
                if (histogram == null || histogram.values == null) return;
                var series = this._series(histogram.values);
                Highcharts.chart(this.querySelector(".container"), {
                    chart: { type: 'column' },
                    title: { text: '' },
                    subtitle: { text: '' },
                    xAxis: { visible: false },
                    yAxis: { visible: false },
                    plotOptions: { column: { pointPadding: 0.1, borderWidth: 0 } },
                    credits : { enabled : false },
                    legend : { enabled : false },
                    series: series
                });
            },

            _series : function(values) {
                var result = [];
                for (var i=0; i<values.length; i++) {
                    let value = values[i];
                    let name = value.name != null ? value.name : "";
                    let valueData = { name: name, data: [ value.value ] };
                    if (value.color != null) valueData.put(value.color);
                    result.push(valueData);
                }
                return result;
            }
        });
    </script>

</dom-module>
