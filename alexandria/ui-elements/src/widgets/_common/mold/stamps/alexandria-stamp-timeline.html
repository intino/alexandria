<link rel="import" href="../../../../../lib/polymer/polymer.html">
<link rel="import" href="alexandria-stamp-behavior.html">

<script src="../../../../../lib/highcharts/highcharts.js"></script>
<script src="../../../../../lib/highcharts/highcharts-more.js"></script>

<dom-module id="alexandria-stamp-timeline">

    <template>
        <div class="container"></div>
    </template>

    <style>
        :host {
            display: block;
            height: 100%;
            width: 100%;
        }
        :host .container {
            height: 100%;
            width: 100%;
            margin-top: 0 !important;
        }
    </style>

    <script>
        Polymer({
            is: 'alexandria-stamp-timeline',

            behaviors: [ AlexandriaBehaviors.StampBehavior ],

            _render : function() {
                window.setTimeout(() => this._renderChart(this.stamp.properties.chartData), 100);
            },

            _renderChart : function(timeline) {
                var container = this.querySelector(".container");
                if (timline == null || timeline.series == null) return;
                var series = this._mapSeries(timeline.series);
                Highcharts.chart(container, {
                    chart: { zoomType: 'xy' },
                    title: { text: '' },
                    credits: { enabled: false },
                    xAxis: [ { labels: { enabled: false }, lineWidth: 0, minorGridLineWidth: 0, lineColor: 'transparent', minorTickLength: 0, tickLength: 0, categories: timeline.categories, crosshair: true }],
                    yAxis: [{ labels: { enabled: false }, lineWidth: 0, minorGridLineWidth: 0, lineColor: 'transparent', minorTickLength: 0, tickLength: 0, title: { text: '', style: { color: Highcharts.getOptions().colors[1] } }}],
                    tooltip: { shared: true },
                    legend: { enabled: false },
                    series: series
                });
            },

            _mapSeries : function(series) {
                var result = [];
                for (var i=0; i<series.length; i++) {
                    var serie = series[i];
                    result.push({ name: serie.name != null ? serie.name : "", type: serie.type.toLowerCase(), color: serie.color, data: serie.values });
                }
                return result;
            }
        });
    </script>

</dom-module>
