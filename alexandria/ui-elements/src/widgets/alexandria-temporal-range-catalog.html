<link rel="import" href="../../lib/polymer/polymer.html">
<link rel="import" href="../../lib/cotton-push/cotton-push-behavior.html">
<link rel="import" href="../../lib/cotton-carrier/cotton-carrier-behavior.html">
<link rel="import" href="../../lib/cotton-zombie/cotton-zombie.html">
<link rel="import" href="../../lib/cotton-translator/cotton-translator-behavior.html">
<link rel="import" href="../../lib/cotton-breadcrumbs/cotton-breadcrumbs.html">
<link rel="import" href="../../lib/paper-toast/paper-toast.html">
<link rel="import" href="_common/catalog/alexandria-catalog-grouping-list.html">
<link rel="import" href="_common/catalog/alexandria-catalog-grouping-list-summary.html">
<link rel="import" href="alexandria-time-range-navigator.html">
<link rel="import" href="alexandriatimerangenavigator/alexandria-vertical-time-range-navigator.html">
<link rel="import" href="alexandria-catalog-view-list.html">
<link rel="import" href="alexandria-dialog-box.html">
<link rel="import" href="_common/alexandria-breadcrumbs-behavior.html">
<link rel="import" href="_common/alexandria-element-behavior.html">
<link rel="import" href="_common/catalog/alexandria-catalog-behavior.html">
<link rel="import" href="_common/catalog/alexandria-temporal-catalog-behavior.html">

<script src="alexandriatemporalrangecatalog/requester.js"></script>
<script src="alexandriatemporalrangecatalog/notifier-listener.js"></script>

<dom-module id="alexandria-temporal-range-catalog">

    <template>
        <h3 hidden$="[[!_showLabel]]">[[_catalog.label]]</h3>
        <cotton-breadcrumbs items="[[_breadcrumbs]]" on-item-selected="_navigate" hidden$="[[!_breadcrumbs.length]]"></cotton-breadcrumbs>
        <div id="main" class$="layout horizontal filtered_[[_filtered]] embedded_[[_catalog.embedded]]">
            <template is="dom-if" if="[[_groupingsLeft]]">
                <alexandria-catalog-grouping-list class="left" id="embeddedGroupings" hidden="[[_hideGroupings]]"
                                                  histograms-mode="[[_catalog.arrangementHistogramsMode]]"
                                                  grouping-list="[[_catalog.groupingList]]"
                                                  on-grouping-selection-change="_handleGroupingChange"
                                                  on-delete-grouping-group="_handleDeleteGroupingGroup"></alexandria-catalog-grouping-list>
            </template>
            <div class$="main flex [[_navigatorLayout]]">
                <alexandria-catalog-grouping-list-summary grouping-list="[[_catalog.groupingList]]"
                                                          on-grouping-selection-change="_handleGroupingChange"></alexandria-catalog-grouping-list-summary>
                <a class="clear" hidden$="[[!_filtered]]" on-tap="clearFilter">[[ClearFilter]]</a>
                <cotton-zombie display="AlexandriaCatalogViewList" widget="AlexandriaCatalogViewList"></cotton-zombie>
                <cotton-zombie id="navigator" display="AlexandriaTimeRangeNavigator" widget$="Alexandria[[_navigatorLayout]]TimeRangeNavigator" object$="[[display.id]]"></cotton-zombie>
            </div>
            <template is="dom-if" if="[[!_groupingsLeft]]">
                <alexandria-catalog-grouping-list class="right" id="embeddedGroupings" hidden="[[_hideGroupings]]"
                                                  histograms-mode="[[_catalog.arrangementHistogramsMode]]"
                                                  grouping-list="[[_catalog.groupingList]]"
                                                  on-grouping-selection-change="_handleGroupingChange"
                                                  on-delete-grouping-group="_handleDeleteGroupingGroup"></alexandria-catalog-grouping-list>
            </template>
        </div>
        <div id="panel" name="panel" class="layout vertical flex hidden" style="height:calc(100% - 60px);"></div>
        <cotton-zombie display="AlexandriaDialogBox" widget="AlexandriaDialogBox"></cotton-zombie>
        <paper-toast class="layout horizontal center" id="itemsArrival" duration="0"><span>[[_itemsArrivalMessage]]</span><paper-button on-tap="_refreshWithArrival">[[RefreshItems]]</paper-button><paper-button on-tap="_closeItemsArrival">[[Close]]</paper-button></paper-toast>
        <paper-toast id="notifyMessageToast" class="fit-bottom message" text="[[_notifyMessage]]"></paper-toast>
    </template>

    <style>
        :host {
            position: relative;
        }
        :host > div {
            width: 100%;
            height: 100%;
        }
        :host .main {
            border: 1px solid #ddd;
            border-left: 0;
            width: 1px;
            @apply(--alexandria-temporal-range-catalog-container);
        }
        :host .main.Vertical {
            position: relative;
        }
        :host .embedded_true .main {
            border-right-width: 0;
        }
        :host .main alexandria-catalog-view-list {
            display: block;
            height: calc(100% - 58px);
        }
        :host .filtered_true .main alexandria-catalog-view-list {
            height: calc(100% - 82px);
        }
        :host .main alexandria-catalog-view-list.full {
            height: 100%;
        }
        :host .filtered_true .main alexandria-catalog-view-list.full {
            height: calc(100% - 30px);
        }
        :host .filtered_true alexandria-catalog-view-list,
        :host .filtered_true .main.Vertical alexandria-vertical-time-range-navigator {
            background: #ffffef;
        }
        :host alexandria-catalog-grouping-list.left {
            border-right: 1px solid #ddd;
        }
        :host alexandria-catalog-grouping-list.right {
            border-left: 1px solid #ddd;
        }
        :host .clear, :host .main alexandria-catalog-grouping-list-summary {
            position: static;
            right: 0;
            background: wheat;
            padding: 8px 10px;
            z-index: 1;
            width: calc(100% - 20px);
            display: block;
            text-align: left;
            font-size: 10pt;
            color: var(--default-primary-color);
        }
        :host .clear {
            cursor: pointer;
        }
        :host .main alexandria-catalog-grouping-list-summary {
            display: none;
            z-index: 2;
            padding: 8px 23px;
            width: calc(100% - 46px);
        }
        :host paper-dialog {
            background: white;
            padding: 10px;
        }
        :host paper-dialog paper-button {
            margin: 0 10px;
            min-width: 80px;
        }
        :host paper-dialog alexandria-catalog-grouping-list {
            display: block;
            margin: 0;
            max-height: 300px;
            border: 0;
            overflow: auto;
        }
        :host alexandria-time-range-navigator {
            margin: 8px 10px 0;
            width: calc(100% - 20px);
        }
        :host alexandria-vertical-time-range-navigator {
            position: absolute;
            top: 0;
            right: 0;
            background: white;
            margin-top: 57px;
            margin-right: 20px;
            height: calc(100% - 57px);
            visibility: hidden;
            opacity:0;
            z-index: -1;
            transition: opacity 0.5s linear, visibility 4s linear, z-index 1s;
        }
        :host alexandria-vertical-time-range-navigator.visible {
            visibility: visible;
            opacity: 0.8;
            z-index: 1;
            transition: opacity 0.5s linear, visibility 4s linear, z-index 0.5s;
        }
        :host alexandria-vertical-time-range-navigator.visible-always {
            visibility: visible !important;
            z-index: 1;
            opacity: 1 !important;
        }
        :host alexandria-vertical-time-range-navigator:hover {
            opacity: 1;
            z-index: 1;
            visibility: visible;
            transition-delay: 5s;
        }
        :host .filtered_true alexandria-vertical-time-range-navigator {
            margin-top: 87px;
            height: calc(100% - 87px);
        }
        :host #panel {
            display: block;
            margin: 0px 6px;
            width: calc(100% - 12px);
        }
        :host #main.hidden, :host #panel.hidden {
            position: absolute;
            left: -10000px;
        }
        :host cotton-breadcrumbs {
            display: block;
            padding: 10px;
            --cotton-breadcrumbs-item-color: var(--default-primary-color);
            --cotton-breadcrumbs-item-border-color: var(--footer-background-color);
            --cotton-breadcrumbs-item-size: 12pt;
            --cotton-breadcrumbs-item-brothers-size: 12pt;
            --cotton-breadcrumbs-item-parents-size: 12pt;
        }
        :host #itemsArrival {
            position: absolute;
            width: 100%;
            background: #333;
            color: white;
            padding: 5px 10px;
            font-size: 10pt;
        }
        :host #itemsArrival span {
            margin-right: 10px;
        }
        @media screen and (max-width: 736px) {
            :host #embeddedGroupings {
                display: none;
            }
            :host cotton-breadcrumbs {
                margin-left: 30px;
                margin-top: 5px;
                margin-bottom: 0;
                padding-bottom: 0;
            }
            :host #main .main {
                width: calc(100% - 40px);
            }
            :host .main alexandria-catalog-view-list {
                height: calc(100% - 24px);
            }
            :host .main alexandria-catalog-grouping-list-summary {
                display: block;
            }
        }
        @media all and (min-width: 600px) and (orientation: portrait) {
            :host #embeddedGroupings {
                display: none;
            }
        }
    </style>

    <script>

        const AlexandriaTemporalRangeCatalogDictionary = {
            es: {
                ClearFilter : "ver todos los elementos",
                Close : "cerrar",
                DefaultItemsArrival : "han llegado nuevos elementos",
                RefreshItems : "actualizar"
            },
            en: {
                ClearFilter : "view all items",
                Close : "close",
                DefaultItemsArrival : "new items arrival",
                RefreshItems : "refresh"
            }
        };

        Polymer({
            is: 'alexandria-temporal-range-catalog',

            behaviors: [ CottonBehaviors.CarrierBehavior,
                CottonBehaviors.PushBehavior,
                CottonBehaviors.TranslatorBehavior,
                AlexandriaBehaviors.BreadcrumbsBehavior,
                AlexandriaBehaviors.TemporalCatalogBehavior,
                AlexandriaBehaviors.CatalogBehavior,
                AlexandriaBehaviors.ElementBehavior,
                AlexandriaTemporalRangeCatalogBehaviors.Requester,
                AlexandriaTemporalRangeCatalogBehaviors.NotifierListener ],

            attached : function() {
                this.translate(AlexandriaTemporalRangeCatalogDictionary);
                this.listenToDisplay();
                this.listenOpenEvents();
                this.$.navigator.whenPersonified().execute((widget) => this._addListeners(widget));
            },

            _showTimeRangeNavigator : function(alwaysVisible) {
                var navigator = this.querySelector("alexandria-time-range-navigator");
                if (navigator != null) navigator.hidden = false;
                navigator = this.querySelector("alexandria-vertical-time-range-navigator");
                if (navigator != null) navigator.isVisible = true;

                if (alwaysVisible) this._showRangeNavigatorAlways();
                else this._hideRangeNavigatorAlways();

                if (this._navigatorLayout != null && this._navigatorLayout == "Vertical") $(this.querySelector("alexandria-catalog-view-list")).addClass("full");
                else $(this.querySelector("alexandria-catalog-view-list")).removeClass("full");
            },

            _hideTimeRangeNavigator : function() {
                var navigator = this.querySelector("alexandria-time-range-navigator");
                if (navigator != null) navigator.hidden = true;
                navigator = this.querySelector("alexandria-vertical-time-range-navigator");
                if (navigator != null) navigator.isVisible = false;
                $(this.querySelector("alexandria-catalog-view-list")).addClass("full");
            }

        });
    </script>
</dom-module>