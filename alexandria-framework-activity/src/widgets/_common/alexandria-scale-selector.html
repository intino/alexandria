<link rel="import" href="../../../lib/polymer/polymer.html">
<link rel="import" href="../../../lib/iron-selector/iron-selector.html">
<link rel="import" href="../../../lib/paper-item/paper-item.html">
<link rel="import" href="../../../lib/paper-ripple/paper-ripple.html">

<dom-module id="alexandria-scale-selector">
    <template>
        <iron-selector selected="[[_current]]" class$="{{mode}}">
            <template is="dom-repeat" items="[[scales]]">
                <paper-item toggles raised on-tap="_scaleSelected" scale="[[item]]">
                    <paper-ripple opacityDecayVelocity="2"></paper-ripple>
                    <a class="symbol" href="#" alt="[[item.label]]" title="[[item.label]]">[[item.symbol]]</a>
                </paper-item>
            </template>
        </iron-selector>
        <div id="visualization"></div>
    </template>

    <style>
        :host {
            display: block;
        }

        :host iron-selector.vertical {
            @apply(--layout-vertical);
        }

        :host iron-selector.horizontal {
            @apply(--layout-horizontal);
            @apply(--layout-center-justified);
        }

        :host iron-selector.horizontal paper-item {
            padding: 8px;
            min-height: 18px;
            line-height: 18px;
            margin: 10px 2px 0;
            width: 18px;
        }

        paper-item {
            padding: 10px;
            margin: 0 0 5px;
            min-width: 0;
            background-color: var(--default-primary-color);
            color: #fff;
            transition: width 0.5s;
            height: 16px;
            width: 20px;
            min-height: 16px;
            text-align: center;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bolder;
            font-size: 10pt;
            line-height: 18px;
            @apply(--alexandria-scale-selector-item);
        }

        :host a {
            color: #fff;
            text-decoration: none;
            position: absolute;
            left: 0;
            width: 100%;
            height: calc(100% - 20px);
            top: 5px;
            padding: 5px 0;
        }

        paper-item.iron-selected {
            background-color: var(--accent-color);
        }

        paper-ripple {
            color: var(--accent-color);
        }
    </style>

    <script>
        Polymer({
            is: 'alexandria-scale-selector',

            properties: {
                scales: { type: Array, value: function() { return []; } },
                selectedScale: { type: String, observer: '_selectScale' },
                mode : { type: String, value : function() { return "vertical"; } },
                _current : Number
            },

            selectScale: function (scale) {
                this._current = this.scales.indexOf(this._findScaleByName(scale));
            },

            _selectScale: function() {
                this.selectScale(this.selectedScale);
            },

            _scaleSelected: function (e) {
                let scale = e.target.scale;
                if (!scale) scale = e.target.parentElement.scale;
                this.selectedScale = scale;
                this.fire('scale-selected', scale.name);
            },

            _findScaleByName: function (name) {
                return this.scales.filter(scale => scale.name === name)[0];
            }
        });
    </script>

</dom-module>
