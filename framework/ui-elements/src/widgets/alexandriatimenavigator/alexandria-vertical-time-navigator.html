<link rel="import" href="../../../lib/polymer/polymer.html">
<link rel="import" href="../../../lib/cotton-push/cotton-push-behavior.html">
<link rel="import" href="../../../lib/cotton-carrier/cotton-carrier-behavior.html">
<link rel="import" href="../../../lib/cotton-zombie/cotton-zombie.html">
<link rel="import" href="../../../lib/cotton-translator/cotton-translator-behavior.html">
<link rel="import" href="../../../lib/cotton-timeline/cotton-timeline.html">
<link rel="import" href="../../../lib/iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="../_common/alexandria-date-selector.html">
<link rel="import" href="../_common/alexandria-scale-selector-slider.html">

<script src="requester.js"></script>
<script src="notifier-listener.js"></script>

<dom-module id="alexandria-vertical-time-navigator">

    <template>
        <cotton-timeline class="layout vertical center-justified" id="timeline"
                         on-next="_moveNext"
                         on-before="_movePrevious"
                         on-select="_updateDate"
                         on-tap-timeline="_showDateSelector">
            <div class="toolbar-top">
                <paper-icon-button icon="icons:date-range" on-tap="_showDateSelector"></paper-icon-button>
            </div>
            <div class="toolbar-bottom">
                <alexandria-scale-selector-slider scales="[[_scaleList]]"
                                                  selected-scale="[[_selectedScale]]"
                                                  on-scale-selected="_notifyScaleSelected"></alexandria-scale-selector-slider>
            </div>
        </cotton-timeline>
        <alexandria-date-selector id="dateSelector" date="[[_range.min]]" scale="[[_selectedScale]]" label="" on-change="_updateSelectorDate"></alexandria-date-selector>
    </template>

    <style>
        :host cotton-timeline {
            height: calc(100% - 25px);
        }
        :host paper-icon-button {
            padding: 0;
            margin: 0 4px;
            display: block;
            height: 18px;
            width: 18px;
        }
        :host alexandria-date-selector {
            position: absolute;
            left: -5000px;
        }
        :host alexandria-scale-selector-slider {
            border: 0;
            --alexandria-scale-selector-slider-control-button : {
                display: none;
            };
        }
    </style>

    <script>

        const AlexandriaVerticalTimeNavigatorDictionary = {
            es: {
            },
            en: {
            }
        };

        Polymer({
            is: 'alexandria-vertical-time-navigator',

            behaviors: [ CottonBehaviors.CarrierBehavior,
                CottonBehaviors.PushBehavior,
                CottonBehaviors.TranslatorBehavior,
                AlexandriaTimeNavigatorBehaviors.Requester,
                AlexandriaTimeNavigatorBehaviors.NotifierListener ],

            properties : {
                _range : { type : Object, value: function() { return null; } },
                _scaleList : Array,
                _selectedScale : String
            },

            attached : function() {
                this.translate(AlexandriaVerticalTimeNavigatorDictionary);
                this.listenToDisplay();
                this._configureTimeline();
            },

            _configureTimeline : function() {
                this.$.timeline.language = this.getLanguage();
            },

            _refreshScales : function(scaleList) {
                this._scaleList = scaleList;
            },

            _refreshScale : function(scale) {
                this._selectedScale = scale;
                this.$.timeline.scale = this._timelineScale(scale);
            },

            _refreshState : function(state) {
            },

            _refreshDate : function(date) {
                this.$.timeline.update(date);
            },

            _refreshOlapRange : function(range) {
                this.$.timeline.range = { min: range.min, max: range.max };
            },

            _refreshZoomRange : function(range) {
            },

            _updateDate : function(event) {
                this.selectDate(event.detail.getTime());
            },

            _moveNext : function() {
                if (this.moveTimeout != null) window.clearTimeout(this.moveTimeout);
                this.moveTimeout = window.setTimeout(() => this.nextDate(), 100);
            },

            _movePrevious : function() {
                if (this.moveTimeout != null) window.clearTimeout(this.moveTimeout);
                this.moveTimeout = window.setTimeout(() => this.previousDate(), 300);
            },

            _showDateSelector : function() {
                this.$.dateSelector.open();
            },

            _notifyScaleSelected : function(e) {
                this.selectScale(e.detail);
            },

            _updateSelectorDate : function(event) {
                this.selectDate(event.detail.date);
            },

            _timelineScale : function(scale) {
                if (scale == "Year" || scale == "QuarterOfYear" || scale == "Month") return "Year";
                if (scale == "SixHours" || scale == "Hour" || scale == "Minute" || scale == "Seconds") return "Day";
                return "Month";
            }
        });
    </script>
</dom-module>