<script>
    'use strict';

    var AlexandriaBehaviors = AlexandriaBehaviors || {};

    AlexandriaBehaviors.ElementBehavior = {

        properties : {
            _breadcrumbs : { type: Object, value: function () { return []; } },
            _notifyMessage : String,
            _lastView : String
        },

        listenOpenEvents : function() {
            this.addEventListener("open-view", this._openView.bind(this));
            this.addEventListener("open-item", this._openItem.bind(this));
            this.addEventListener("open-element", this._openElement.bind(this));
        },

        _openView : function(e) {
            var view = e.detail;
            this.openView(view);
            if (e.stopPropagation) e.stopPropagation();
            this._lastView = view;
        },

        _openItem : function(e) {
            this.openItem(e.detail);
            if (e.stopPropagation) e.stopPropagation();
        },

        _openElement : function(e) {
            this.openElement(e.detail);
            if (e.stopPropagation) e.stopPropagation();
        },

        _refreshBreadcrumbs : function(tree) {
            this._breadcrumbs = tree != null && tree !== "" ? this.treeToBreadcrumbs(tree) : [];
        },

        _createPanel : function(params) {
            if (this.$.panel == null) return;
            var zombie = document.createElement("cotton-zombie");
            zombie.setAttribute("display", params.displayType);
            zombie.setAttribute("widget", params.displayType);
            zombie.setAttribute("object", params.item);
            this.$.panel.innerHTML = "";
            this.$.panel.appendChild(zombie);
        },

        _showPanel : function() {
            if (this.$.main == null || this.$.panel == null) return;
            $(this.$.main).addClass("hidden");
            $(this.$.panel).removeClass("hidden");
        },

        _hidePanel : function() {
            if (this.$.main == null || this.$.panel == null) return;
            $(this.$.main).removeClass("hidden");
            $(this.$.panel).addClass("hidden");
            if (this._lastView != null) this.openView(this._lastView);
        },

        _notifyUser : function(message) {
            if (this.$.notifyMessageToast == null) return;
            this._notifyMessage = message;
            this.$.notifyMessageToast.open();
        },

        _showDialogBox : function() {
            var dialogBox = this.querySelector("alexandria-dialog-box");
            if (dialogBox != null) dialogBox.open();
        },

        _navigate : function(e) {
            var name = atob(e.detail.item.name);
            if (name == "main") this.home();
            else this.openItem(name);
        }

    };

</script>
