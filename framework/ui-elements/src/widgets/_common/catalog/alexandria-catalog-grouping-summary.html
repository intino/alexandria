<link rel="import" href="../../../../lib/polymer/polymer.html">
<link rel="import" href="../../../../lib/cotton-translator/cotton-translator-behavior.html">
<link rel="import" href="../../../../lib/paper-icon-button/paper-icon-button.html">

<script src="../../../../lib/cotton-cookies/cookies.js"></script>

<dom-module id="alexandria-catalog-grouping-summary">

    <template>
        <template is="dom-repeat" items="[[_selection]]" as="group">
            <li name="[[group.name]]"><span>[[group.label]]</span><paper-icon-button group="[[group]]" icon="clear" on-tap="_deleteGroup"></paper-icon-button></li>
        </template>
    </template>

    <style>
        :host {
            @apply(--layout-horizontal);
        }
        :host li {
            margin-right: 10px;
            padding-right: 20px;
            margin-bottom: 2px;
            position: relative;
            white-space: nowrap;
        }
        :host paper-icon-button {
            width: 20px;
            height: 20px;
            padding: 2px;
            position: absolute;
            margin-top: -2px;
        }
    </style>

    <script>
        const AlexandriaCatalogGroupingSummaryDictionary = {
            es: {
            },
            en: {
            }
        };

        Polymer({
            is: 'alexandria-catalog-grouping-summary',

            properties: {
                grouping: { type: Object, value: function() { return []; }, observer: '_refreshSelection' },
                _selection : Array,
                _excluded : String
            },

            behaviors: [ CottonBehaviors.TranslatorBehavior ],

            attached: function () {
                this.translate(AlexandriaCatalogGroupingSummaryDictionary);
            },

            _refreshSelection : function() {
                this.notifyPath("_selection", this._getSelection());
            },

            getSelectedGroups : function() {
                return this._getSelection().map(g => g.name);
            },

            _getSelection : function() {
                var groupList = this.grouping.groupList;
                var selectedList = [];
                for (var i=0; i<groupList.length; i++) {
                    var group = groupList[i];
                    group.grouping = this.grouping.name;
                    if (group.selected) {
                        if (this._excluded == null || group.name != this._excluded)
                            selectedList.push(group);
                    }
                }
                return selectedList;
            },

            _deleteGroup : function(e) {
                var li = $(event.target).parents("li").get(0);
                this._excluded = li.name;
                this.fire('selection-change', { name: this.grouping.name });
                this._excluded = null;
            }

        });
    </script>

</dom-module>
