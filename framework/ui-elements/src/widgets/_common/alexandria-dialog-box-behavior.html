<script>
    'use strict';

    var AlexandriaBehaviors = AlexandriaBehaviors || {};

    AlexandriaBehaviors.DialogBoxBehavior = {
        _openedPosition: null,

        Dictionary : {
            es : {
                Accept : "aceptar"
            },
            en : {
                Accept : "accept"
            }
        },

        properties : {
            _width : { type: Number, value: function() { return 100; } },
            _height : { type: Number, value: function() { return 100; } },
            _position : { type: Object, value: function() { return null; } },
            _toolbarVisible : { type: Boolean, value: function() { return false; } },
            _resized : Boolean
        },

        listeners: { 'iron-resize': '_resize' },

        _resize : function() {
            this._updateSize();
            this._fitToTrigger();
        },

        open : function() {
            if (this.$.dialog.opened) this.close();
            this._addClasses();
            this._updateOpenedPosition();
            var dialog = this.$.dialog;
            dialog.withBackdrop = !this._isFitted();
            dialog.entryAnimation = !this._isFitted() ? "scale-up-animation" : "fade-in-animation";
            dialog.resizerShouldNotify(false);
            dialog.open();
            window.setTimeout(() => this._resize(), 10);
        },

        close : function() {
            this.$.dialog.close();
        },

        _overlayOpened : function(e) {
            if (this._isFitted()) return;
            var dialog = e.target;
            var overlay = dialog.backdropElement;

            if (overlay.previousSibling !== dialog && !this._overlayFixed) {
                dialog.parentNode.insertBefore(overlay, null);
                this._overlayFixed = true;
            }
        },

        _overlayClosed : function(e) {
            this._resized = false;
            this._overlayFixed = false;
        },

        _closeDialog : function() {
            this.close();
        },

        _updateSize : function() {
            var style = this.$.dialog.style;

            if (this._width != 100) {
                var width = $(window).width();
                style.minWidth = this._width + "%";
                style.width = this._width + "%";
                style.marginLeft = ((width-(width*(this._width / 100)))/2) + "px";
                style.left = "0px";
            }
            else {
                style.minWidth = "calc(100% - 100px)";
                style.width = "calc(100% - 100px)";
                style.left = "0px";
            }

            if (this._height != 100) {
                var height = $(window).height();
                style.minHeight = this._height + "%";
                style.height = this._height + "%";
                style.marginTop = ((height - (height * (this._height / 100))) / 2) + "px";
                style.top = "0px";
            }
            else {
                style.minHeight = "calc(100% - 100px)";
                style.height = "calc(100% - 100px)";
                style.top = "0px";
            }
        },

        _fitToTrigger : function() {
            if (!this._isFitted()) return;
            var dialog = this.$.dialog;
            dialog.style.marginLeft = 0;
            dialog.style.marginTop = "25px";
            var left = this._left();
            var top = this._top();
            var windowWidth = $(window).width();
            var windowHeight = $(window).height();
            var dialogWidth = $(dialog).width();
            var dialogHeight = $(dialog).height();
            var position = left + dialogWidth > windowWidth ? "right" : ((left + dialogWidth/2) > windowWidth ? "center" : "left");
            left = position === "left" ? left : left - (position === "center" ? dialogWidth/2 : dialogWidth);
            dialog.style.top = top + dialogHeight > windowHeight ? (top-dialogHeight - 30) + "px" : (top + 5) + "px";
            dialog.style.left = (left + 3) + "px";
        },

        _addClasses : function() {
            var dialog = $(this.$.dialog);
            dialog.removeClass("fit-body");
            dialog.removeClass("fit-trigger");
            dialog.addClass(this._isFitted() ? "fit-trigger" : "fit-body");
        },

        _isFitted : function() {
            return AlexandriaBehaviors.DialogBoxBehavior._openedPosition != null;
        },

        _left : function() {
            return AlexandriaBehaviors.DialogBoxBehavior._openedPosition.left;
        },

        _top : function() {
            return AlexandriaBehaviors.DialogBoxBehavior._openedPosition.top;
        },

        _updateOpenedPosition : function() {
            AlexandriaBehaviors.DialogBoxBehavior._openedPosition = this._position;
        }

    };

</script>