<link rel="import" href="../../lib/polymer/polymer.html">
<link rel="import" href="../../lib/cotton-push/cotton-push-behavior.html">
<link rel="import" href="../../lib/cotton-carrier/cotton-carrier-behavior.html">
<link rel="import" href="../../lib/cotton-zombie/cotton-zombie.html">
<link rel="import" href="../../lib/cotton-translator/cotton-translator-behavior.html">
<link rel="import" href="../../lib/paper-tabs/paper-tabs.html">
<link rel="import" href="../../lib/paper-tabs/paper-tab.html">
<link rel="import" href="alexandria-view-container-magazine.html">
<link rel="import" href="alexandria-view-container-list.html">
<link rel="import" href="alexandria-view-container-map.html">
<link rel="import" href="alexandria-view-container-display.html">
<link rel="import" href="_common/alexandria-view-behavior.html">

<script src="alexandriacatalogviewlist/requester.js"></script>
<script src="alexandriacatalogviewlist/notifier-listener.js"></script>

<dom-module id="alexandria-catalog-view-list">

    <template>
        <div class="layout horizontal end-justified" hidden$="[[_viewListHidden]]">
            <paper-tabs selected="{{_selectedView}}">
                <template is="dom-repeat" items="[[_viewList]]" as="view">
                    <paper-tab view="[[view]]">[[_viewLabelOf(view)]]</paper-tab>
                </template>
            </paper-tabs>
        </div>
        <iron-pages id="scrollingRegion" selected="{{_selectedView}}" class$="fullSize_[[_viewListHidden]]">
            <template is="dom-repeat" items="[[_viewList]]" as="view">
                <template is="dom-if" if="[[_isMagazineContainer(view)]]">
                    <div><cotton-zombie display="AlexandriaViewContainerMagazine" widget="AlexandriaViewContainerMagazine" object$="[[display.id]][[view.name]]"></cotton-zombie></div>
                </template>
                <template is="dom-if" if="[[_isListContainer(view)]]">
                    <div><cotton-zombie display="AlexandriaViewContainerList" widget="AlexandriaViewContainerList" object$="[[display.id]][[view.name]]"></cotton-zombie></div>
                </template>
                <template is="dom-if" if="[[_isGridContainer(view)]]">
                    <div><cotton-zombie display="AlexandriaViewContainerList" widget="AlexandriaViewContainerList" object$="[[display.id]][[view.name]]"></cotton-zombie></div>
                </template>
                <template is="dom-if" if="[[_isMapContainer(view)]]">
                    <div><cotton-zombie display="AlexandriaViewContainerMap" widget="AlexandriaViewContainerMap" object$="[[display.id]][[view.name]]"></cotton-zombie></div>
                </template>
                <template is="dom-if" if="[[_isDisplayContainer(view)]]">
                    <div><cotton-zombie display="AlexandriaViewContainerDisplay" widget="AlexandriaViewContainerDisplay" object$="[[display.id]][[view.name]]"></cotton-zombie></div>
                </template>
            </template>
        </iron-pages>
    </template>

    <style>
        :host paper-tabs {
            width: auto;
            margin: 0 10px;
            height: 25px;
            --paper-tabs-selection-bar: {
                border-color: var(--accent-color);
            }
        }
        :host iron-pages {
            height: calc(100% - 25px);
            overflow: auto;
        }
        :host iron-pages.fullSize_true {
            height: calc(100%);
        }
        :host iron-pages > div {
            height: 100%;
            overflow: hidden;
        }
    </style>

    <script>

        const AlexandriaCatalogViewListDictionary = {
            es: {
            },
            en: {
            }
        };

        Polymer({
            is: 'alexandria-catalog-view-list',
            lastViewIndex : null,

            behaviors: [ CottonBehaviors.CarrierBehavior,
                CottonBehaviors.PushBehavior,
                CottonBehaviors.TranslatorBehavior,
                AlexandriaBehaviors.ViewBehavior,
                AlexandriaCatalogViewListBehaviors.Requester,
                AlexandriaCatalogViewListBehaviors.NotifierListener ],

            properties : {
                _viewList: Array,
                _viewListHidden: Boolean,
                _selectedView: { type: Number, value: function () { return 0; }, observer: '_selectView' }
            },

            attached : function() {
                this.translate(AlexandriaCatalogViewListDictionary);
                this.translate(AlexandriaBehaviors.ViewBehavior.Dictionary);
                this.listenToDisplay();
            },

            _refreshViewList : function(viewList) {
                this._viewList = this._addBooleanType(viewList);
                this._viewListHidden = this._viewList.length <= 1;
            },

            _refreshSelectedView : function(name) {
                var index = this._viewIndex(name);
                if (this._selectedView == index) return;
                this._selectedView = index;
            },

            _viewIndex : function(name) {
                for (var i=0; i<this._viewList.length; i++)
                    if (this._viewList[i].name == name)
                        return i;
                return 0;
            },

            _addBooleanType : function(viewList) {
                return viewList;
                for(var i=0; i<viewList.length; i++) {
                    var view = viewList[i];
                    this.magazine = this._isMagazineContainer(view);
                    this.list = this._isListContainer(view);
                    this.map = this._isMapContainer(view);
                    this.display = this._isDisplayContainer(view);
                }
            },

            _selectView : function(pos) {
                var element = this.querySelector("paper-tabs").items[pos];
                if (element == null) return;
                if (this.lastViewIndex == pos) return;
                this.lastViewIndex = pos;
                this.fire("open-view", element.view.name);
            }

        });
    </script>
</dom-module>