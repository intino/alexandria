<link rel="import" href="../../lib/polymer/polymer.html">
<link rel="import" href="../../lib/cotton-push/cotton-push-behavior.html">
<link rel="import" href="../../lib/cotton-carrier/cotton-carrier-behavior.html">
<link rel="import" href="../../lib/cotton-zombie/cotton-zombie.html">
<link rel="import" href="../../lib/cotton-translator/cotton-translator-behavior.html">
<link rel="import" href="_common/alexandria-view-behavior.html">
<link rel="import" href="_common/catalog/alexandria-catalog-list.html">

<script src="alexandriaviewcontainerlist/requester.js"></script>
<script src="alexandriaviewcontainerlist/notifier-listener.js"></script>

<dom-module id="alexandria-view-container-list">

    <template>
        <alexandria-catalog-list grid="[[_isGridContainer(_view)]]"
                                 mold="[[_view.mold]]"
                                 width="[[_view.width]]"
                                 embedded="[[_view.embeddedElement]]"
                                 empty-message="[[_view.emptyMessage]]"
                                 can-search="[[_view.canSearch]]"
                                 selection-enabled-by-default="[[_view.selectionEnabledByDefault]]"
                                 page-size="[[_pageSize]]"
                                 item-list="[[_itemList]]"
                                 count-item-list="[[_countItemList]]"
                                 sorting-list="[[_sortingList]]"
                                 selected-sorting="[[_selectedSorting]]"
                                 on-load-page="_loadPage"
                                 on-select-sorting="_selectSorting"
                                 on-stamps-ready="_renderExpandedPictures"
                                 on-open-stamp-dialog="_openStampDialog"
                                 on-open-stamp-catalog="_openStampCatalog"
                                 on-execute-stamp-task="_executeStampTask"
                                 on-navigate-catalog="_navigateCatalog"
                                 on-open-item="_openItem"
                                 on-change-item="_changeItem"
                                 on-validate-item="_validateItem"
                                 on-select-items="_selectItems"
                                 on-download-item="_downloadItem"
                                 on-filter="_filter"
                                 toolbar="[[_view.toolbar]]"
                                 on-execute-operation="_executeOperation"
                                 on-download-operation="_downloadOperation"></alexandria-catalog-list>
    </template>

    <style>
    </style>

    <script>

        const AlexandriaViewContainerListDictionary = {
            es: {
            },
            en: {
            }
        };

        Polymer({
            is: 'alexandria-view-container-list',

            behaviors: [ CottonBehaviors.CarrierBehavior,
                CottonBehaviors.PushBehavior,
                CottonBehaviors.TranslatorBehavior,
                AlexandriaBehaviors.ViewBehavior,
                AlexandriaViewContainerListBehaviors.Requester,
                AlexandriaViewContainerListBehaviors.NotifierListener ],

            properties : {
                _view: Object,
                _itemList: Array,
                _countItemList: Number,
                _sortingList: Array,
                _selectedSorting : Object
            },

            attached : function() {
                this.translate(AlexandriaViewContainerListDictionary);
                this.translate(AlexandriaBehaviors.ViewBehavior.Dictionary);
                this.listenToDisplay();
            },

            _refreshView : function(view) {
                this._view = view;
            },

            _clear : function() {
                this.querySelector("alexandria-catalog-list").clear();
            },

            _refresh : function(items) {
                this._itemList = items;
            },

            _refreshPageSize : function(pageSize) {
                this._pageSize = pageSize;
            },

            _refreshItem : function(info) {
                var item = info.item;
                this.querySelector("alexandria-catalog-list").refreshItem(info);
                this.itemRefreshed(item.name);
            },

            _resizeItem : function(item) {
                this.querySelector("alexandria-catalog-list").resizeItem(item);
            },

            _refreshItemValidation : function(info) {
                this.querySelector("alexandria-catalog-list").refreshItemValidation(info.message, info.stamp, info.item);
            },

            _refreshPicture : function(pictureData) {
                this.querySelector("alexandria-catalog-list").refreshItemPicture(pictureData);
            },

            _refreshCount : function(count) {
                this._countItemList = count;
            },

            _navigateCatalog : function(e) {
                e.stopPropagation();
                this.fire("open-element", e.detail);
            },

            _openItem : function(e) {
                e.stopPropagation();
                this.fire("open-item", e.detail);
            },

            _changeItem : function(e) {
                this.changeItem(e.detail);
                e.stopPropagation();
            },

            _validateItem : function(e) {
                this.validateItem(e.detail);
                e.stopPropagation();
            },

            _downloadItem : function(e) {
                this.downloadItemOperation(e.detail);
            },

            _selectItems : function(e) {
                this.selectItems(e.detail);
            },

            _refreshSelection : function(selection) {
                this.querySelector("alexandria-catalog-list").refreshSelection(selection);
            },

            _refreshSortingList : function(sortingList) {
                this._sortingList = sortingList;
            },

            _refreshSelectedSorting : function(sorting) {
                this._selectedSorting = sorting;
            },

            _selectSorting : function(e) {
                this.selectSorting(e.detail);
            },

            _isGridContainer : function(view) {
                return view.type.toLowerCase() === "view-container-grid";
            },

            _loadPage : function(e) {
                this.page(e.detail.page);
            },

            _renderExpandedPictures : function(e) {
                if (this.timer != null)
                    window.clearTimeout(this.timer);
                this.timer = window.setTimeout(() => this.renderExpandedPictures(), 100);
            },

            _openStampDialog : function(e) {
                this.openItemDialogOperation(e.detail);
            },

            _openStampCatalog : function(e) {
                this.openItemCatalogOperation(e.detail);
            },

            _executeStampTask : function(e) {
                this.executeItemTaskOperation(e.detail);
            },

            _filter : function(e) {
                this.filter(e.detail);
            },

            _executeOperation : function(e) {
                this.executeOperation(e.detail);
            },

            _downloadOperation : function(e) {
                this.downloadOperation(e.detail);
            }

        });
    </script>
</dom-module>