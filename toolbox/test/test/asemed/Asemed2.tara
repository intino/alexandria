dsl Konos

Datalake datalake as Local("{datalake}")
	Split("DA" "DB") porDivisiones

	Tank("asemed.Criterio") criterio as Event(Criterio)
	Tank("asemed.CriterioBorrado") criterioBorrado as Event(CriterioBorrado)
	Tank("asemed.CriterioModificado") criterioModificado as Event(CriterioModificado)
	Tank("asemed.CriterioSentencia") criterioSentencia as Event(CriterioSentencia)
	Tank("asemed.CriterioSentenciaModificada") criterioSentenciaModificada as Event(CriterioSentenciaModificada)
	Tank("asemed.CriterioSentenciaBorrada") criterioSentenciaBorrada as Event(CriterioSentenciaBorrada)
	Tank("asemed.CriterioHabilitado") criterioHabilitado as Event(CriterioHabilitado)
	Tank("asemed.CriterioDeshabilitado") criterioDeshabilitado as Event(CriterioDeshabilitado)
	Tank("asemed.CriterioEvolucionado") criterioEvolucionado as Event(CriterioEvolucionado)

	Tank("asemed.UsuarioConectado") usuarioConectado as Event(UsuarioConectado)
	Tank("asemed.UsuarioDesconectado") usuarioDesconectado as Event(UsuarioDesconectado)
	Tank("asemed.Despacho") despacho as Event(schema = Despacho)
	Tank("asemed.Inspeccion") inspeccion as Event(schema = Inspeccion)
	Tank("asemed.Ajuste") ajuste as Event(schema = Ajuste)

	Tank("EsCFE") EsCFE as Set(porDivisiones) Singleton
	Tank("EsEmpleado") EsEmpleado as Set(porDivisiones) Singleton
	Tank("Giro") Giro as Set
	Tank("Estatus") Estatus as Set
	Tank("Poblacion.Tipo") poblacionTipo as Set
	Tank("Contrato.Potencia") contratoPotencia as Set
	Tank("Contrato.Firma") Firma as Set
	Tank("Contrato.Alta") Alta as Set
	Tank("Contrato.Baja") Baja as Set
	Tank("Contrato.Estatus") contratoEstatus as Set
	Tank("Facturacion.Periodicidad") Periodicidad as Set
	Tank("Facturacion.Modo") Modo as Set
	Tank("Facturacion.EsColectiva") EsColectiva as Set Singleton
	Tank("Facturacion.EsEspecial") EsEspecial as Set Singleton
	Tank("Facturacion.EsPuntual") EsPuntual as Set Singleton
	Tank("Tarifa.Tipo") tarifaTipo as Set
	Tank("Transformador.Conexiones") Conexiones as Set
	Tank("Conexion.Tipo") conexionTipo as Set
	Tank("Conexion.Hilos") Hilos as Set
	Tank("Conexion.PorteaEnergia") PorteaEnergia as Set
	Tank("Conexion.GeneraEnergiaRenovable") GeneraEnergiaRenovable as Set
	Tank("Conexion.Potencia") Potencia as Set
	Tank("Conexion.Conectado") conexionConectado as Set
	Tank("Conexion.Desconectado") conexionDesconectado as Set
	Tank("Conexion.Reconectado") Reconectado as Set
	Tank("Medidor.Tipo") medidorTipo as Set
	Tank("Medidor.Estatus") medidorEstatus as Set
	Tank("Medidor.Caratulas") Caratulas as Set
	Tank("Medidor.Multiplicador") Multiplicador as Set
	Tank("Medidor.Instalado") Instalado as Set
	Tank("Medidor.Retirado") Retirado as Set
	Tank("Medidor.Conectado") Conectado as Set
	Tank("Medidor.Desconectado") Desconectado as Set
	Tank("Medidor.Sellado") Sellado as Set
	Tank("Medidor.Cambiado") Cambiado as Set
	Tank("Medidor.Fabricacion.Fecha") Fecha as Set
	Tank("Lectura.Tipo") Tipo as Set
	Tank("Lectura.Negativa") Negativa as Set
	Tank("Consumo.Facturado") Facturado as Set
	Tank("Consumo.NoFacturado") NoFacturado as Set
	Tank("Consumo.MalFacturado") MalFacturado as Set
	Tank("Consumo.Abatimiento") Abatimiento as Set
	Tank("Consumo.FacturaAbatida") FacturaAbatida as Set
	Tank("Consumo.PromedioDiario") consumoPromedioDiario as Set
	Tank("Consumo.Plano") Plano as Set
	Tank("Consumo.DiferenciaConMaxCPD") DiferenciaConMaxCPD as Set
	Tank("Demanda.PromedioDiario") demandaPromedioDiario as Set
	Tank("Demanda.FactorCarga") FactorCarga as Set
	Tank("Demanda.FactorCargaPromedioDiario") FactorCargaPromedioDiario as Set
	Tank("Demanda.FactorPotencia") FactorPotencia as Set
	Tank("Revision.Inspeccion") revisionInspeccion as Set
	Tank("Revision.Inspeccionado") revisionInspeccionado as Set


Datamart("{datamart}") datamart

Feeder(datalake.ajuste) ajusteFeeder
Feeder(datalake.criterio datalake.criterioBorrado) criteriosFeeder

Mounter inspeccionados as Batch
	Source as Population
		Column(datalake.revisionInspeccion, type = Long) as Id
		Column(datalake.revisionInspeccion, type = Timetag)
		Column(datalake.EsCFE, type = Boolean)  as Constant(value = "sss")
		Column(datalake.EsEmpleado, type = Boolean)
		Column(datalake.Giro, type = Nominal)
		Column(datalake.Estatus, type = String)
		Column(datalake.poblacionTipo, type = String)
		Column(datalake.contratoPotencia, type = String)
		Column(datalake.Firma, type = String)
		Column(datalake.Alta, type = String)
		Column(datalake.Baja, type = String)
		Column(datalake.contratoEstatus, type = String)
		Column(datalake.Periodicidad, type = String)
		Column(datalake.Modo, type = String)
		Column(datalake.EsColectiva, type = String)
		Column(datalake.EsEspecial, type = String)
		Column(datalake.EsPuntual, type = String)
		Column(datalake.tarifaTipo, type = String)
		Column(datalake.Conexiones, type = String)
		Column(datalake.conexionTipo, type = String)
		Column(datalake.Hilos, type = String)
		Column(datalake.PorteaEnergia, type = String)
		Column(datalake.GeneraEnergiaRenovable, type = String)
		Column(datalake.Potencia, type = String)
		Column(datalake.conexionConectado, type = String)
		Column(datalake.conexionDesconectado, type = String)
		Column(datalake.Reconectado, type = String)
		Column(datalake.medidorTipo, type = String)
		Column(datalake.medidorEstatus, type = String)
		Column(datalake.Caratulas, type = String)
		Column(datalake.Multiplicador, type = String)
		Column(datalake.Instalado, type = String)
		Column(datalake.Retirado, type = String)
		Column(datalake.Conectado, type = String)
		Column(datalake.Desconectado, type = String)
		Column(datalake.Sellado, type = String)
		Column(datalake.Cambiado, type = String)
		Column(datalake.Fecha, type = String)
		Column(datalake.Tipo, type = String)
		Column(datalake.Negativa, type = String)
		Column(datalake.Facturado, type = String)
		Column(datalake.NoFacturado, type = String)
		Column(datalake.MalFacturado, type = String)
		Column(datalake.Abatimiento, type = String)
		Column(datalake.FacturaAbatida, type = String)
		Column(datalake.consumoPromedioDiario, type = String)
		Column(datalake.Plano, type = String)
		Column(datalake.DiferenciaConMaxCPD, type = String)
		Column(datalake.demandaPromedioDiario, type = String)
		Column(datalake.FactorCarga, type = String)
		Column(datalake.FactorCargaPromedioDiario, type = String)
		Column(datalake.FactorPotencia, type = String)
		Column(datalake.revisionInspeccion, type = String)
		Column(datalake.revisionInspeccionado, type = String)
	Collect as File(format = Arff, datamart = datamart)

Mounter ajuste as Realtime
	Source as Events
		Select(datalake.ajuste)
	Collect as Graph(datamart)


Mounter criterios as Realtime
	Source as Events
		Select(datalake.criterio)
		Select(datalake.criterioBorrado)
	Collect as Graph(datamart = datamart)

Task MountAjuste as BootTrigger

Schema Evento
	Attribute ts as DateTime
	Attribute autor as Text

Schema Criterio as ExtensionOf(Evento)
	Attribute nombre as Text
	Attribute descripcion as Text
	Attribute tipo as Text
	Attribute filtroInteligente as Text
	Attribute divisiones as Text List

Schema CriterioBorrado as ExtensionOf(Evento)
	Attribute criterio as Text

Schema CriterioModificado as ExtensionOf(Evento)
	Attribute criterio as Text
	Attribute descripcion as Text
	Attribute tipo as Text
	Attribute filtroInteligente as Text
	Attribute divisiones as Text List

Schema CriterioEvolucionado as ExtensionOf(Evento)
	Attribute criterio as Text

Schema CriterioConsultaModificada as ExtensionOf(Evento)
	Attribute criterio as Text
	Attribute consulta as Text
	Attribute esValida as Bool

Schema CriterioSentencia as ExtensionOf(Evento)
	Attribute criterio as Text
	Attribute consulta as Text
	Attribute descripcion as Text
	Attribute tipo as Text
	Attribute esValida as Bool

Schema CriterioSentenciaModificada as ExtensionOf(Evento)
	Attribute criterio as Text
	Attribute sentencia as Text
	Attribute descripcion as Text
	Attribute consulta as Text
	Attribute esValida as Bool

Schema CriterioSentenciaBorrada as ExtensionOf(Evento)
	Attribute criterio as Text
	Attribute sentencia as Text

Schema CriterioHabilitado as ExtensionOf(Evento)
	Attribute criterio as Text

Schema CriterioDeshabilitado as ExtensionOf(Evento)
	Attribute criterio as Text

Schema Despacho as ExtensionOf(Evento)
	Attribute nombre as Text
	Attribute rpu as LongInteger

Schema Inspeccion as ExtensionOf(Evento)
	Attribute revision as Text

Schema Ajuste as ExtensionOf(Evento)
	Attribute revision as Text

Schema UsuarioConectado as ExtensionOf(Evento)
Schema UsuarioDesconectado as ExtensionOf(Evento)