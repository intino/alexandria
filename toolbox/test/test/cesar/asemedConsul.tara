dsl Konos

Service screening as REST(host = "https://api.asemed.cfe.mx", port = "443")
	logo = "/logo.png"
	favicon = "/favicon.png"
	color ="#FFFFFF"
	subtitle = "Asemed. Portal de APIs"
	Info(title = "Servicio de screeening", version = "1.0")
		description = "Modulo de análisis y gestión de Pérdidas no Técnicas de CFE"
	Tag("Estructura organizacional de los trabajos de revisión en CFE") Compañía
	Tag("Análisis de pérdidas no técnicas") Análisis
	Tag("Gestión de revisiones") Gestión

	Resource("/divisiones") divisiones
		Get

			description = "Proporciona un listado con todas las divisiones"
			tags = "Compañía"
			Response as List Text
	Resource("/divisiones/:division/rutas") rutas
		Get
			description = "Proporciona un listado con todas las rutas de una división"
			tags = "Compañía"
			Parameter(in = path) division as Text
			Parameter(in = query) pagina as Integer
				description = "Número de página"
			Response aaa as List Text
				description = "El número máximo de rutas que se incluyen en la respuesta es 200. Para acceder a las siguientes rutas es necesario indicar un número de pagina"
	Resource("/divisiones/:division/:ruta/inspectores") inspectores
		Get
			description = "Proporciona todos los inspectores que existen en una ruta"
			tags = "Compañía"
			Parameter(in = path) division as Text
			Parameter(in = path) ruta as Text
			Parameter(in = query) pagina as Integer
				description = "Número de página"
			Response as List Text
				description = "El número máximo de inspectores que se incluyen en la respuesta es 200. Para acceder a los siguientes inspectores es necesario indicar un número de pagina"

	Resource("/sospechosos") sospechosos
		Get
			description = "Proporciona una lista de los sospechosos que no están en revisión ordenados de mayor a menor probabilidad de estar provocando una pérdida no técnica"
			tags = "Análisis"
			Parameter(in = query, isRequired = true) division as Text
				description = "Código de una división"
			Parameter(in = query, isRequired = true) criterio as Word("Tecnico" "Contable" "Datos")
				description = "Tipo de criterio por el que se desea buscar sospechosos"
			Parameter(in = query, isRequired = true) umbral as Text
				description = "Probabilidad mínima que se exige para encontrar a un sospechoso"
			Parameter(in = query) ruta as Text
				description = "Código de ruta a la que debe estar asignado un sospechoso"
			Parameter(in = query) pagina as Integer
				description = "Número de página"
			Response as List Object(Sospechoso)
				description = "El número máximo de sospechosos que se incluyen en la respuesta es 200. Para acceder a los siguientes sospechosos es necesario indicar un número de pagina"

	Resource("/sospechosos/:rpu") sospechoso
		Get
			description = "Proporciona una ficha detallada de un sospechoso, incluyendo todas las revisiones que ha tenido o están en curso"
			tags = "Análisis"
			Parameter(in = path) rpu as LongInteger
				description = "RPU de la ficha que se desea obtener"
			Response as Object(FichaRPU) //incluye todas las revisiones
			Exception(BadRequest)

	Resource("/revisiones") revisiones
		Get
			description = "Proporciona una lista de las revisiones en curso"
			tags = "Gestión"
			Parameter(in = query) pagina as Integer
				description = "Número de página"
			Response as List Object(Revision)
				description = "El número máximo de revisiones que se incluyen en la respuesta es 200. Para acceder a las siguientes revisiones es necesario indicar un número de pagina"

	Resource("/revisiones/:revision") revision
		Post
			description = "Registra una nueva revisión asociada a un RPU sospechoso. El estado inicial de una revisión es despachada."
			tags = "Gestión"
			Parameter(in = path) revision as Text
				description = "Código de la revisión"
			Parameter(in = query) rpu as LongInteger
				description = "RPU asociado a la revisión"
			Response(code = "200")
		Get
			description = "Proporciona el estado de una revisión"
			tags = "Gestión"
			Parameter(in = path) revision as Text
				description = "Código de revisión"
			Response as Object(Revision)
			Exception(BadRequest)
	Resource("/revisiones/:revision/inspeccion") parteInspeccion
		Post(description = "Informa al sistema del resultado de una inspección. El estado cambia a inspeccionada")
			tags = "Gestión"
			Parameter(in = path) revision as Text
			Parameter(in = body) resultado as Object(ParteInspeccion)
			Response(description = "") //TODO
			Exception(BadRequest)
	Resource("/revisiones/:revision/cierre") cierre
		Post(description = "Informa al sistema del resultado del cierre. El estado cambia a cerrada")
			tags = "Gestión"
			Parameter(in = path) revision as Text
			Parameter(in = body) parte as Object(ParteCierre)
			Response(description = "") //TODO
			Exception(BadRequest)

Schema Sospechoso
	Attribute rpu as LongInteger
	Attribute ruta as Text
	Attribute probabilidadTotalAnomalia as Real
	Schema Criterio
		Attribute nombre as Text
		Attribute probabilidad as Real

Schema Revision
	Attribute rpu as LongInteger
	Attribute codigo as Text
	Attribute revision as Real
	Attribute estado as Word("Despachada" "Inspeccionada" "Cerrada")

Schema FichaRPU
	Attribute probabilidad as Real
	Attribute probabilidadCriterios as List Object(ProbabilidadCriterio)
	Attribute cliente as Object(Cliente)
	Attribute revisiones as Text List

Schema Cliente
	Attribute nombre as Text
	Attribute apellidos as Text
	Attribute colonia as Text
	Attribute esEmpleado as Bool
	Attribute generaEnergiaRenovable as Bool
	Attribute porteaEnergia as Bool
	Attribute usoPropio as Bool
	Attribute contratoInfer as Word("C0A" "C0B" "C1A" "C1B")

Schema ProbabilidadCriterio
	Attribute nombre as Text
	Attribute probabilidad as Real


Schema ParteInspeccion
	Attribute fecha as DateTime
	Attribute resultado as Word("Positiva" "Negativa")
	Attribute anomalia as Text

Schema ParteCierre
	Attribute fecha as DateTime
	Attribute resultado as Word("Cobrado" "Incobrado" "Improcedente")
	Attribute kwhRecuperados as Real
	Attribute kwhRecuperables as Real
	Attribute costosRevisión as Real

Schema InfoVisionGeneral
	Attribute contable as List Object(Indicador)
	Attribute tecnico as List Object(Indicador)
	Attribute datos as List Object(Indicador)

Schema InfoIndicadores
	Attribute timeline as Object(Timeline)
	Attribute ultimoPeriodo as List Object(Indicador)
	Attribute totales as List Object(Indicador)

Schema Indicador
	Attribute nombre as Text
	Attribute valor as Text
	Attribute tendencia as Word("Positiva" "Negativa")
	Attribute modoTendencia as Word("PositivaMejor" "PositivaPeor")

Schema Balance
	Attribute periodo as Text
	Attribute sospechosos as Integer
	Attribute despachados as Integer
	Attribute inspeccionadosPositivos as Integer
	Attribute inspeccionadosNegativos as Integer
	Attribute resueltos as Integer
	Attribute potencial as Real
	Attribute recuperado as Real
	Attribute impacto as Real
	Attribute utilidad as Real
	Attribute tae as Real
	Attribute tar as Real
	Attribute precision as Real
	Attribute eficiencia as Real

Schema Configuracion
	Schema periodo
		Attribute nombre as Text
		Attribute titulo as Text
	Attribute periodo as Text
	Attribute ventanaPeriodo as Integer
	Attribute indicador as Text

Schema InfoCriterio
	Attribute titulo as Text
	Attribute tituloOperacion as Text
	Attribute nombre as Text
	Attribute descripcion as Text
	Attribute tipo as Text
	Attribute filtroInteligente as Text

Schema ParamsCriterio
	Attribute nombre as Text
	Attribute descripcion as Text
	Attribute tipo as Text

Schema ParamsDialogoCriterio
	Attribute nombre as Text
	Attribute descripcion as Text
	Attribute tipo as Text
	Attribute filtroInteligente as Text

Schema Grafica
	Attribute nombre as Text

Schema Timeline as ExtensionOf(Grafica)
	Attribute(defaultValue="timeline") tipo as Text
	Attribute periodos as List Text
	Schema Serie
		Attribute nombre as Text
		Attribute color as Text
		Attribute valores as List Real

Schema Histograma as ExtensionOf(Grafica)
	Attribute(defaultValue="histograma") tipo as Text
    Schema Valor
        Attribute nombre as Text
        Attribute valor as Integer

Schema InfoReferencias
	Attribute nombre as Text
	Attribute tipo as Text
	Attribute referencias as Object(Referencia) List

Schema Referencia
	Attribute nombre as Text
	Attribute titulo as Text
	Attribute tipo as Text
	Attribute ranking as Text
	Attribute fechaModificacion as DateTime

Schema Categoria
	Attribute nombre as Text
	Attribute hijos as List Object(Categoria)

Schema ParamsValor
	Attribute nombre as Text
	Attribute indice as Integer

Schema InfoAsistente
	Attribute pasos as List Text
	Attribute ultimoPaso as Bool
	Attribute nombreCriterioNuevo as Text

Schema InfoSelectorCriterio
	Attribute referencias as List Object(Referencia)
	Attribute nombreNuevo as Text

Schema Paso
	Attribute nombre as Text
	Attribute puedeAvanzar as Bool
	Attribute resultado as Text

Schema Periodo
	Attribute opcion as Word("PeriodoActual" "Rango")
	Attribute cantidad as Integer
	Attribute escala as Word("Anho" "Mes" "Dia" "Hora")
	Attribute desde as DateTime
	Attribute hasta as DateTime

	Schema(multiple=false) Recencia
		Attribute cantidad as Integer
		Attribute rango as Word("Antiguos" "Nuevos")

Schema ParamsSeleccionNumerica
	Attribute limiteInferior as Real
	Attribute limiteSuperior as Real
	Attribute valores as Text List

Schema Rango
	Attribute desde as Real
	Attribute hasta as Real
	Attribute paso as Real

Schema ConfigDialogoCriterio
	Attribute tipos as Object(Referencia) List
	Attribute filtrosInteligentes as Object(Referencia) List

Schema ConfigSelectorZona
	Attribute divisiones as Text List
	Attribute zonas as Text List

Schema ParamsSeleccionHistograma
	Attribute variable as Text
	Attribute valores as Text List

Schema ResultadoBusqueda
	Attribute opciones as Text List
	Attribute numeroOpcionesTotal as Integer