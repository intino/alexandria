package io.intino.konos.builder.codegeneration.services.ui.display.catalog;

import org.siani.itrules.LineSeparator;
import org.siani.itrules.Template;

import java.util.Locale;

import static org.siani.itrules.LineSeparator.LF;

public class AbstractCatalogSkeletonTemplate extends Template {

	protected AbstractCatalogSkeletonTemplate(Locale locale, LineSeparator separator) {
		super(locale, separator);
	}

	public static Template create() {
		return new AbstractCatalogSkeletonTemplate(Locale.ENGLISH, LF).define();
	}

	public Template define() {
		add(
				rule().add((condition("type", "catalog & gen"))).add(literal("package ")).add(mark("package")).add(literal(".displays;\n\nimport io.intino.alexandria.ui.displays.AlexandriaCatalog;\nimport io.intino.alexandria.ui.model.View;\nimport io.intino.alexandria.ui.model.Catalog;\nimport io.intino.alexandria.ui.model.TemporalCatalog;\nimport io.intino.alexandria.ui.model.Mold;\nimport io.intino.alexandria.ui.model.Toolbar;\nimport io.intino.alexandria.ui.model.catalog.arrangement.Arrangement;\nimport io.intino.alexandria.ui.model.catalog.arrangement.Grouping;\nimport io.intino.alexandria.ui.model.catalog.events.OnClickItem;\nimport io.intino.alexandria.ui.model.View;\nimport io.intino.alexandria.ui.model.TimeScale;\nimport io.intino.alexandria.ui.model.toolbar.*;\n\nimport ")).add(mark("package", "validPackage")).add(literal(".")).add(mark("box", "firstUpperCase")).add(literal("Box;\nimport ")).add(mark("package", "validPackage")).add(literal(".displays.notifiers.")).add(mark("name", "firstUpperCase")).add(literal("Notifier;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\npublic abstract class Abstract")).add(mark("name", "FirstUpperCase")).add(literal(" extends io.intino.alexandria.ui.displays.Alexandria")).add(expression().add(literal("Temporal")).add(mark("mode"))).add(literal("Catalog<")).add(mark("name", "FirstUpperCase")).add(literal("Notifier> {\n\n\tpublic Abstract")).add(mark("name", "FirstUpperCase")).add(literal("(")).add(mark("box", "firstUpperCase")).add(literal("Box box) {\n\t\tsuper(box);\n\t\telement(buildCatalog(box));\n\t}\n\n\tprivate static ")).add(expression().add(literal("io.intino.alexandria.ui.model.Temporal")).add(mark("mode", "empty"))).add(literal("Catalog buildCatalog(")).add(mark("box", "firstUpperCase")).add(literal("Box box) {\n\t\tio.intino.alexandria.ui.model.")).add(expression().add(literal("Temporal")).add(mark("mode", "empty"))).add(literal("Catalog catalog = new io.intino.alexandria.ui.model.")).add(expression().add(literal("Temporal")).add(mark("mode", "empty"))).add(literal("Catalog();\n\t\tcatalog.objectsLoader((scope, condition")).add(expression().add(literal(", ")).add(mark("mode", "timerange"))).add(literal(", session) -> (java.util.List<Object>)(Object) ")).add(mark("name", "firstUpperCase")).add(literal(".Source.")).add(mark("type", "shortType", "firstLowerCase")).add(literal("List(box, scope, condition")).add(expression().add(literal(", ")).add(mark("mode", "timerange"))).add(literal(", session));")).add(expression().add(literal("\n")).add(literal("\t\t")).add(mark("mode", "setMode"))).add(expression().add(literal("\n")).add(literal("        ")).add(mark("temporalFilter"))).add(expression().add(literal("\n")).add(literal("\t\t")).add(mark("range"))).add(expression().add(literal("\n")).add(literal("\t\tcatalog.scales(new ArrayList<TimeScale>() {{ ")).add(mark("scale", "scaleAdd").multiple("; ")).add(literal(" }});"))).add(expression().add(literal("\n")).add(literal("\t\t")).add(mark("hasMagazineView"))).add(expression().add(literal("\n")).add(literal("\t\tcatalog.events(new io.intino.alexandria.ui.model.catalog.Events().onClickItem(new OnClickItem().")).add(mark("event")).add(literal("));"))).add(expression().add(literal("\n")).add(literal("\t\t")).add(mark("hasGroupings"))).add(expression().add(literal("\n")).add(literal("\t\t")).add(mark("hasCustomItemsArrivalMessage"))).add(expression().add(literal("\n")).add(literal("\t\t")).add(mark("toolbar", "empty")).add(literal("catalog.toolbar(buildToolbar(box));"))).add(expression().add(literal("\n")).add(literal("\t\tcatalog.name(\"")).add(mark("name")).add(literal("\")"))).add(expression().add(literal(".label(\"")).add(mark("label")).add(literal("\")"))).add(literal(";\n\t\tcatalog.objectLoader((id, session) -> ")).add(mark("name", "firstUpperCase")).add(literal(".Source.")).add(mark("type", "shortType", "firstLowerCase")).add(literal("(box, id, session))\n\t\t\t.objectIdLoader(object -> ")).add(mark("name", "firstUpperCase")).add(literal(".Source.")).add(mark("type", "shortType", "firstLowerCase")).add(literal("Id(box, (")).add(mark("type")).add(literal(")object))\n\t\t\t.objectNameLoader(object -> ")).add(mark("name", "firstUpperCase")).add(literal(".Source.")).add(mark("type", "shortType", "firstLowerCase")).add(literal("Name(box, (")).add(mark("type")).add(literal(") object));\n\t\tbuildViews(box).forEach(v -> catalog.add(v));\n\t\tbuildArrangements(box).forEach(a -> catalog.add(a));\n\t\treturn catalog;\n\t}\n\t")).add(expression().add(literal("\n")).add(literal("\t")).add(mark("toolbar")).add(literal("\n")).add(literal("\t"))).add(literal("\n\tprivate static java.util.List<View> buildViews(")).add(mark("box", "firstUpperCase")).add(literal("Box box) {\n\t\tList<View> result = new ArrayList<>();\n\t\t")).add(mark("view", "add").multiple("\n")).add(literal("\n\t\treturn result;\n\t}\n\n\tprivate static java.util.List<Arrangement> buildArrangements(")).add(mark("box", "firstUpperCase")).add(literal("Box box) {\n\t\tList<Arrangement> arrangements = new ArrayList<>();\n\t\t")).add(mark("arrangement", "add").multiple("\n")).add(literal("\n\t\treturn arrangements;\n\t}\n}")),
			rule().add((condition("trigger", "empty"))),
			rule().add((condition("trigger", "setMode"))).add(literal("catalog.type(TemporalCatalog.Type.")).add(mark("value", "firstUpperCase")).add(literal(");")),
				rule().add((condition("trigger", "temporalFilter"))).add(literal("catalog.temporalFilter(new io.intino.alexandria.ui.model.catalog.TemporalFilter().enabledLoader(")).add(mark("temporalFilterEnabled")).add(literal(").visibilityLoader(")).add(mark("temporalFilterVisible")).add(literal(").layout(\"")).add(mark("temporalFilterLayout")).add(literal("\"));")),
			rule().add((condition("attribute", "conditional")), (condition("trigger", "temporalFilterEnabled"))).add(literal("(c, scope, session) -> ")).add(mark("catalog", "FirstUpperCase")).add(literal(".TemporalFilter.enable(box, c, scope, session)")),
			rule().add((condition("attribute", "always")), (condition("trigger", "temporalFilterEnabled"))).add(literal("(c, scope, session) -> true")),
			rule().add((condition("attribute", "never")), (condition("trigger", "temporalFilterEnabled"))).add(literal("(c, scope, session) -> false")),
			rule().add((condition("attribute", "conditional")), (condition("trigger", "temporalFilterVisible"))).add(literal("(c, scope, session) -> ")).add(mark("catalog", "FirstUpperCase")).add(literal(".TemporalFilter.visible(box, c, scope, session)")),
			rule().add((condition("attribute", "always")), (condition("trigger", "temporalFilterVisible"))).add(literal("(c, scope, session) -> true")),
			rule().add((condition("attribute", "never")), (condition("trigger", "temporalFilterVisible"))).add(literal("(c, scope, session) -> false")),
			rule().add((condition("trigger", "range"))).add(literal("catalog.rangeLoader(session -> ")).add(mark("catalog", "FirstUpperCase")).add(literal(".Temporal.range(box, session));\ncatalog.objectCreatedLoader(object -> ")).add(mark("catalog", "FirstUpperCase")).add(literal(".Source.")).add(mark("type", "shortType", "firstLowerCase")).add(literal("Created(box, (")).add(mark("type")).add(literal(") object));")),
			rule().add((condition("trigger", "timeRange"))).add(literal("range")),
			rule().add((condition("trigger", "scaleAdd"))).add(literal("add(TimeScale.")).add(mark("value", "FirstUpperCase")).add(literal(");")),
			rule().add((condition("trigger", "hasMagazineView"))).add(literal("catalog.rootObjectLoader((objectList, range, session) -> ")).add(mark("name", "firstUpperCase")).add(literal(".Source.root")).add(mark("type", "shortType", "firstUpperCase")).add(literal("(box, (java.util.List<")).add(mark("type")).add(literal(">)(Object)objectList")).add(expression().add(literal(", ")).add(mark("mode", "timerange"))).add(literal(", session));\ncatalog.defaultObjectLoader((id, range, session) -> ")).add(mark("name", "firstUpperCase")).add(literal(".Source.default")).add(mark("type", "shortType", "firstUpperCase")).add(literal("(box, id")).add(expression().add(literal(", ")).add(mark("mode", "timerange"))).add(literal(", session));")),
			rule().add((condition("trigger", "hasGroupings"))).add(literal("catalog.arrangementFiltererLoader((session) -> ")).add(mark("name", "firstUpperCase")).add(literal(".Arrangements.filterer(box, session));\ncatalog.arrangementHistogramsMode(\"")).add(mark("histogramsMode")).add(literal("\");")),
			rule().add((condition("trigger", "hasCustomItemsArrivalMessage"))).add(literal("catalog.itemsArrivalMessageLoader((count, session) -> ")).add(mark("name", "firstUpperCase")).add(literal(".Source.itemsArrivalMessage(box, count, session));")),
				rule().add((condition("trigger", "toolbar"))).add(literal("private static io.intino.alexandria.ui.model.Toolbar buildToolbar(")).add(mark("box", "firstUpperCase")).add(literal("Box box) {\n\tio.intino.alexandria.ui.model.Toolbar result = new Toolbar();\n\tresult.canSearch(")).add(mark("canSearch")).add(literal(");\n\t")).add(mark("operation", "add").multiple("\n")).add(literal("\n\treturn result;\n}")),
				rule().add((condition("type", "openDialog")), (condition("trigger", "event"))).add(literal("openDialog(new io.intino.alexandria.ui.model.catalog.events.OpenDialog()")).add(expression().add(literal(".height(")).add(mark("height")).add(literal(")"))).add(expression().add(literal(".width(")).add(mark("width")).add(literal(")"))).add(literal(".dialogType(\"")).add(mark("dialog")).add(literal("\").dialogBuilder((item, session) -> {\n\tio.intino.alexandria.ui.displays.AlexandriaDialog dialog = ")).add(mark("package", "validPackage")).add(literal(".dialogs.Dialogs.dialogFor(box, \"")).add(mark("dialog")).add(literal("\");\n\tdialog.target(item);\n\treturn dialog;\n}))")),
				rule().add((condition("type", "openPanel")), (condition("trigger", "event"))).add(literal("openPanel(new io.intino.alexandria.ui.model.catalog.events.OpenPanel()\n\t")).add(expression().add(literal(".breadcrumbs(")).add(mark("breadCrumbs")).add(literal(")"))).add(literal("\n\t.panel((io.intino.alexandria.ui.model.Panel) Displays.displayFor(box, \"")).add(mark("panel")).add(literal("\").element()))")),
				rule().add((condition("type", "openCatalog")), (condition("trigger", "event"))).add(literal("openCatalog(new io.intino.alexandria.ui.model.catalog.events.OpenCatalog()\n\t")).add(expression().add(literal(".itemLoader(")).add(mark("openCatalogLoader")).add(literal(")"))).add(literal("\n\t")).add(expression().add(literal(".filter(")).add(mark("openCatalogFilter")).add(literal(")"))).add(literal("\n\t.catalog((io.intino.alexandria.ui.model.Catalog) Displays.displayFor(box, \"")).add(mark("catalog")).add(literal("\").element()))")),
			rule().add((condition("trigger", "breadCrumbs"))).add(literal("(object, session) -> ")).add(mark("catalog", "FirstUpperCase")).add(literal(".Events.onOpenPanelBreadcrumbs(box, (")).add(mark("type")).add(literal(") object, session)")),
			rule().add((condition("trigger", "openCatalogLoader"))).add(literal("(element, sender, session) -> ")).add(mark("catalog", "FirstUpperCase")).add(literal(".Events.onOpenCatalog(box, element, (")).add(mark("type")).add(literal(") sender, session)")),
			rule().add((condition("trigger", "openCatalogFilter"))).add(literal("(element, sender, item, session) -> ")).add(mark("catalog", "FirstUpperCase")).add(literal(".Events.onOpenCatalogFilter(box, element, (")).add(mark("type")).add(literal(") sender, item, session)")),
				rule().add((condition("type", "sorting")), (condition("trigger", "add"))).add(literal("arrangements.add(new io.intino.alexandria.ui.model.catalog.arrangement.Sorting().comparator((object1, object2) -> ")).add(mark("catalog", "FirstUpperCase")).add(literal(".Arrangements.")).add(mark("name", "FirstLowerCase")).add(literal("Comparator(box, (")).add(mark("type")).add(literal(")object1, (")).add(mark("type")).add(literal(")object2)).visible(")).add(mark("visible")).add(literal(").name(\"")).add(mark("name")).add(literal("\").label(\"")).add(mark("label")).add(literal("\"));")),
				rule().add((condition("type", "grouping")), (condition("trigger", "add"))).add(literal("arrangements.add(new io.intino.alexandria.ui.model.catalog.arrangement.Grouping()")).add(expression().add(literal(".histogram(io.intino.alexandria.ui.model.catalog.arrangement.Grouping.Histogram.")).add(mark("histogram")).add(literal(")"))).add(literal(".groups((objects, session) -> ")).add(mark("catalog", "FirstUpperCase")).add(literal(".Arrangements.")).add(mark("name", "FirstLowerCase")).add(literal("(box, (List<")).add(mark("type")).add(literal(">)(Object)objects, session)).name(\"")).add(mark("name")).add(literal("\")")).add(expression().add(literal(".label(\"")).add(mark("label")).add(literal("\")"))).add(literal(");")),
			rule().add((condition("trigger", "add"))).add(literal("result.add(")).add(mark("value")).add(literal(");"))
		);
		return this;
	}
}