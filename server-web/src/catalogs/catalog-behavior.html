<script>
    var KonosBehaviors = KonosBehaviors || {};

    KonosBehaviors.CatalogBehavior = {

        properties : {
            refreshingSelection : { type: Boolean, value: function() { return false; } },
            selectedItemList : { type: Object, value: function() { return null; } }
        },

        observers: [
            '_selectionChanged(selectedItemList.splices)'
        ],

        selectItems : function(component, items) {
            this.clearSelection(component);
            for (var i=0; i<items.length; i++)
                this.selectItem(component, items[i]);
        },

        selectItem : function(component, name) {
            this.refreshingSelection = true;

            var item = this._getComponentItem(component, name);
            if (item != null)
                component.selectItem(item);

            this.refreshingSelection = false;
        },

        unSelectItem : function(component, name) {
            this.refreshingSelection = true;

            var item = this._getComponentItem(component, name);
            if (item != null)
                component.deselectItem(item);

            this.refreshingSelection = false;
        },

        clearSelection : function(component) {
            this.refreshingSelection = true;

            if (component.clearSelection) {
                component.clearSelection();
                return;
            }

            var items = component.items;
            if (items == null) return;
            for(var i=0; i<items.length; i++) {
                if (this._isSelected(component, items[i]))
                    component.selectItem(items[i]);
            }

            this.refreshingSelection = false;
        },

        _refreshSelection : function(component, selection) {
            if (selection == null || selection.length == 0) {
                this.clearSelection(component);
                return;
            }
            this.selectItems(component, selection);
        },

        _isSelected : function(component, item) {
            var selection = component.selectedItems;
            if (selection == null) return false;
            for(var i=0; i<selection.length; i++) {
                if (selection[i].name == item.name) return true;
            }
            return false;
        },

        selectionOf : function(component) {
            var selection = component.selectedItems;
            var result = [];
            if (selection == null) return { "items" : result };
            selection.forEach(function(item) { result.push(item.name != null ? item.name : item); });
            return { "items" : result };
        },

        selectionOfItem : function(item) {
            return { "items" : [ item ] };
        },

        _getComponentItem : function(component, name) {
            var items = component.items;
            if (items == null) return null;
            for (var i=0; i<items.length; i++)
                if (items[i].name == name)
                    return items[i];
            return null;
        },

        _getComponentItemIndex : function(component, name) {
            var items = component.items;
            if (items == null) return null;
            for (var i=0; i<items.length; i++)
                if (items[i].name == name)
                    return i;
            return -1;
        }

    };
</script>
